<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="perihelion of poSTmortem">
<title>The Atari ST MC68000 Assembly Language Tutorials</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<a href="https://github.com/nguillaumin/perihelion-m68k-tutorials"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_on_fading_to_black" class="book toc2 toc-left">
<div id="header">
<h1>The Atari ST MC68000 Assembly Language Tutorials</h1>
<div class="details">
<span id="author" class="author">perihelion of poSTmortem</span><br>
<span id="revnumber">version 1st edition (v0.84),</span>
<span id="revdate">August 28th 2004 | edited by bp</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">The Atari ST MC68000 Assembly Language Tutorials</a></span></p><ul class="sectlevel1">
<li><a href="_foreword.html">Foreword</a>
</li>
<li><a href="_on_the_theory_behind_programming.html">On The Theory Behind Programming</a>
</li>
<li><a href="_of_the_workings_of_devpac_3_and_the_realisation_of_some_code.html">Of The Workings Of Devpac 3 And The Realisation Of Some Code</a>
</li>
<li><a href="_of_various_things_mystic_and_important_mainly_concerning_the_art_of_understanding_digits_and_performing_traps.html">Of Various Things Mystic And Important, Mainly Concerning The Art Of Understanding Digits And Performing Traps</a>
</li>
<li><a href="_of_the_ways_of_addressing_memory.html">Of The Ways Of Addressing Memory</a>
</li>
<li><a href="_of_the_workings_of_the_graphics_memory_and_minor_skills_in_branching.html">Of The Workings Of The Graphics Memory And Minor Skills In Branching</a>
</li>
<li><a href="_of_seeing_behind_the_curtain_of_an_execution_and_getting_intimate_with_files.html">Of Seeing Behind The Curtain Of An Execution And Getting Intimate With Files</a>
</li>
<li><a href="_on_scrollers.html">On Scrollers</a>
</li>
<li><a href="_of_scrolling_8_pixels_per_vbl_using_double_buffer.html">Of Scrolling 8 Pixels Per VBL Using Double Buffer</a>
</li>
<li><a href="_of_revealing_the_unseen_and_expanding_our_consciousness_without_the_use_of_illegal_drugs.html">Of Revealing The Unseen And Expanding Our Consciousness Without The Use Of Illegal Drugs</a>
</li>
<li><a href="_of_lighting_a_candle_and_casting_a_shadow.html">Of Lighting A Candle (And Casting A Shadow)</a>
</li>
<li><a href="_of_making_the_mountain_move_to_mohammed.html">Of Making The Mountain Move To Mohammed</a>
</li>
<li><a href="_of_controlling_the_puppets.html">Of Controlling The Puppets</a>
</li>
<li><a href="_of_hearing_that_which_is_spoken.html">Of Hearing That Which Is Spoken</a>
</li>
<li><a href="_of_using_the_gramophone.html">Of Using The Gramophone</a>
</li>
<li><a href="_on_fading_to_black.html"><span class="toc-current">On Fading To Black</span></a>
</li>
<li><a href="_appendixes.html">Appendixes</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_on_fading_to_black">On Fading To Black</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>2002-03-28 (last edition of the initial revision)</em></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I wish for this night-time<br>
to last for a lifetime<br>
The darkness around me<br>
Shores of a solar sea<br>
Oh how I wish to go down with the sun<br>
Sleeping<br>
Weeping<br>
With you</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Nightwish<br>
<cite>Sleeping Sun</cite>
</div>
</div>
<div class="paragraph">
<p>It has occurred to me that by striving ever forward, we&#8217;ve forgotten to speak about some
basic things, so for this tutorial and the next one, we&#8217;ll be taking a step back and reviewing
some things. You may have guessed these techniques yourself, but it never hurts to have it
spelled out. Also, I thought I&#8217;d share some new thoughts on development, we&#8217;ll take that
first.</p>
</div>
<div class="paragraph">
<p>Most of the source for the tutorials in the past I&#8217;ve actually written in Devpac on a real Atari,
but it has now become clear to me that developing in Windows on an IBM compatible is
easier and more efficient. I got the tip over at <a href="http://www.atari-forum.com/" class="bare">http://www.atari-forum.com/</a>, a discussion forum for
all topics Atari (where I&#8217;m one of the moderators for the coding section, yay). Have one
"launcher file" with only one line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="kr">include</span> <span class="nv">whateveryoursourcename</span><span class="p">.</span><span class="nv">s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By doing this, you&#8217;ll assemble any source files you want, and you can edit those source files
outside of Devpac, and then assemble them in Devpac. When I wrote this tutorial, I had a file
named <code>_WRAP.S</code> that had the line <code>include tut15.s</code> in it. Then I used Ultraedit (my editor of
choice) to edit <code>tut15.s</code>, I also had Devpac running under STEem. Whenever I felt like
assembling my source, I just saved in Ultraedit, <code>ALT+Tab</code>-bed into STEem and hit <code>ALT+a</code> to
assemble my source; smooth and easy.</p>
</div>
<div class="paragraph">
<p>Speaking of Ultraedit, there is a topic going on over at <a href="http://www.atari-forum.com/viewtopic.php?t=946" class="bare">http://www.atari-forum.com/viewtopic.php?t=946</a>
to try and work out good syntax highlighting for Atari assembly in Ultraedit (<a href="http://www.ultraedit.com/" class="bare">http://www.ultraedit.com/</a>).
Wow, that&#8217;s a lot of various things you wouldn&#8217;t have seen pop up in a tutorial from say 1994.
Now onto the serious stuff.</p>
</div>
<div class="paragraph">
<p>The palette is an extremely powerful thing when you want to change colours quick and easy.
Unfortunately it has the obvious limitation of not changing the pixels. Using the palette you
can black out the screen without erasing the contents (by setting all colours to black), make
things pulse (by incrementing and decrementing colour intensity) or wait with displaying a
picture. Say you want to calculate a big fractal, just set the palette to all 0, calculate your
fractal, then whip in the palette to display the result. The effect will be that no one will see
you draw the fractal, only the final result will be shown.
As we&#8217;ve been through before, there are 16 colours in the palette, the first one being the
background colour, located at <code>$ff8240</code>. Each colour is a word long, making the palette end at
<code>$ff825e</code>. Each word is built up like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">00000RRR0GGG0BBB</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first three bits control blue intensity, then there&#8217;s a zero bit, the next three bits control
green intensity, a zero and the final (non-zero) three bits control red intensity. The maximum
value you can get out of three bits is 8, and since the colour intensities are at 4 bit
boundaries, they are very easy to access in hex (since each character in hex mode is a 4 bit
quantity). Thus <code>$700</code> means max intensity of red and zero intensity for green and blue, <code>$444</code>
means medium intensity for all three colours.</p>
</div>
<div class="paragraph">
<p>When they built the STe, they thought that it would be nice to have more colours in the
palette, and indeed, it&#8217;s easy to just add an additional bit since that would still have the
palette on a 4 bit boundary, making each colour range from 0-15. However, there was a
problem, they could not add a bit in the beginning and just shift the other bits to the left,
since that would mean all old palette values would in effect be shifted left one bit creating an
entirely different value than was originally intended.</p>
</div>
<div class="paragraph">
<p>The solution to this problem is cunning, but unfortunate. They added the least significant bit
where the zero bit used to be. This maintains backwards compatibility, and adds 8 new
possible colour intensities. So the STe palette looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">0000rRRRgGGGbBBB</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that $700 is still (almost) maximum intensity of red. What in the memory is
perceived as the most significant bit, is in palette terms the least significant bit. This sounds
very confusing perhaps, but just picture moving the uppermost bit of each colour intensity
first. Let&#8217;s say then that we want the intensity between <code>$100</code> and <code>$200</code>, this would be colour
<code>$900</code>, since that would be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">0000rRRRgGGGbBBB</span>
<span class="nl">0000100100000000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which we can interpret as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">0000RRRrGGGgBBBb</span>
<span class="nl">0000001100000000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, when using the STe palette, we must think about the fact that the most significant bit
for each colour, is in actuality the least significant bit. The number order for intensities, from
lowest to highest is 0, 8, 1, 9, 2, A, 3, B, 4, C, 5, D, 6, E, 7, F. So if you use colour <code>$fff</code>, the
STe will interpret this as intensity 15 for all colours, and the ST will interpret it as colour
intensity 7, since the ST doesn&#8217;t care about whether the fourth bit is set or not.</p>
</div>
<div class="paragraph">
<p>That should be all there is to the palette, making full utilization of it will be up to each one. In
order to do something I thought we&#8217;d just do a simple fade in effect. Fading in a picture is so
much nicer than just whipping it onto screen. Fading out is also much nicer than just zapping
it away, you can also fade to white and make the screen sort of flash away.</p>
</div>
<div class="paragraph">
<p>What we want is to begin with a black palette and pixel data on the screen, then increment
the colour values of the palette until they reach the values intended for the picture. In order
to keep things simple, I opted to skip the STe palette since there&#8217;s lots of shifting involved
whenever you want to use it. So the fade will only have a maximum of 7 intensities to work
with, making it a pretty bad looking fade effect.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll need a copy of the original palette, and a current palette which we increment until it
reaches the original. It would be tempting to compare the real palette to the current one and
add <code>$111</code> (one intensity of each colour) if they don&#8217;t match, but that won&#8217;t work. Say one
colour is supposed to be <code>$100</code>, if we compare our current <code>$000</code> with that, they don&#8217;t match,
so we add <code>$111</code> making the current colour <code>$111</code>, which is more than <code>$100</code>. Instead, we must
compare each red, green and blue value individually. This can easily be done by just masking
off all bits except the three controlling the intensity for either red, green or blue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">a1</span>                 <span class="c1">; restore a1</span>

                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%011100000000</span><span class="p">,</span> <span class="nb">d0</span>        <span class="c1">; mask off all but red values</span>
                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%011100000000</span><span class="p">,</span> <span class="nb">d1</span>        <span class="c1">; mask off all but red values</span>

                <span class="k">cmp</span><span class="nd">.w </span>  <span class="nb">d1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; see if red is correct intensity</span>
                <span class="k">beq</span>     <span class="nv">red_fin</span>                   <span class="c1">; if not ...</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000100000000</span><span class="p">,</span> <span class="nb">d1</span>        <span class="c1">; ... add one intensity of red</span>
<span class="nl">red_fin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s assume <code>d0</code> holds the real colour, and <code>d1</code> holds the temporary. All bits except the ones
controlling red are masked off, then values compared. If they do not match, add one to the
value. The value to add will be different depending on which intensity we check for, since
different intensities begin at different bit positions. That&#8217;s pretty much it, here&#8217;s the entire
source</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="kr">section</span> <span class="nv">text</span>

                <span class="k">jsr</span>     <span class="nv">initialise</span>

                <span class="k">movem</span><span class="nd">.l </span><span class="nv">picture</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span>          <span class="c1">; put picture palette in d0-d7</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="p">,</span> <span class="nv">pal</span>                <span class="c1">; copy palette to pal</span>

                <span class="k">movem</span><span class="nd">.l </span><span class="nv">temp_pal</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span>           <span class="c1">; put current palette in d0-d7</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="p">,</span> <span class="mh">$ff8240</span>            <span class="c1">; apply current palette (all 0)</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>                 <span class="c1">; get physbase</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">14</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a7</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nb">d0</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; a0 points to screen memory</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">picture</span><span class="o">+</span><span class="mi">34</span><span class="p">,</span> <span class="nb">a1</span>           <span class="c1">; a1 points to picture</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">7999</span><span class="p">,</span> <span class="nb">d0</span>                 <span class="c1">; 8000 longwords to a screen</span>
<span class="nl">loop</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>              <span class="c1">; move one longword to screen</span>
                <span class="k">dbf</span>     <span class="nb">d0</span><span class="p">,</span> <span class="nv">loop</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$70</span><span class="p">,</span> <span class="nv">old_70</span>               <span class="c1">; backup $70</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="kr">main</span><span class="p">,</span> <span class="mh">$70</span>                <span class="c1">; start main routine</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>                 <span class="c1">; wait keypress</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">1</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a7</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nv">old_70</span><span class="p">,</span> <span class="mh">$70</span>               <span class="c1">; restore $70</span>

                <span class="k">jsr</span> <span class="nv">restore</span>

                <span class="k">clr</span><span class="nd">.l </span>  <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">1</span>

<span class="nl">main</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nv">sr</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>                 <span class="c1">; backup status register</span>
                <span class="k">or</span><span class="nd">.w </span>   <span class="nd">#</span><span class="mh">$0700</span><span class="p">,</span> <span class="nv">sr</span>                <span class="c1">; disable interrupts</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="o">/</span><span class="nb">a0</span><span class="o">-</span><span class="nb">a6</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>        <span class="c1">; backup registers</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">counter</span>               <span class="c1">; increment counter variable</span>
                <span class="k">cmp</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">15</span><span class="p">,</span> <span class="nv">counter</span>              <span class="c1">; only execute main sometimes</span>
                <span class="k">bne</span>     <span class="nv">do_nothing</span>                <span class="c1">; skip instructions</span>
                <span class="k">clr</span><span class="nd">.l </span>  <span class="nv">counter</span>                   <span class="c1">; reset counter</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">pal</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; a0 points to values to reach</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">temp_pal</span><span class="p">,</span> <span class="nb">a1</span>             <span class="c1">; a1 points to current values</span>

                <span class="kr">rept</span>    <span class="mi">16</span>                        <span class="c1">; do for each color</span>
                <span class="k">jsr</span>     <span class="nv">check_red</span>                 <span class="c1">; see if red intensity should increase</span>
                <span class="k">jsr</span>     <span class="nv">check_green</span>               <span class="c1">; see if green intensity should increase</span>
                <span class="k">jsr</span>     <span class="nv">check_blue</span>                <span class="c1">; see if blue intensity should increase</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; point to next color</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; point to next color</span>
                <span class="kr">endr</span>

                <span class="k">movem</span><span class="nd">.l </span><span class="nv">temp_pal</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span>           <span class="c1">; put current palette in d0-d7</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="p">,</span> <span class="mh">$ff8240</span>            <span class="c1">; apply current palette</span>

<span class="nl">do_nothing</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="o">/</span><span class="nb">a0</span><span class="o">-</span><span class="nb">a6</span>        <span class="c1">; restore registers</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nv">sr</span>                 <span class="c1">; restore status register</span>
                <span class="nv">rte</span>                               <span class="c1">; finished interrupt</span>


<span class="nl">check_red</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                  <span class="c1">; move one final color into d0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a1</span><span class="p">),</span> <span class="nb">d1</span>                  <span class="c1">; move one temp color into d1</span>

                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%011100000000</span><span class="p">,</span> <span class="nb">d0</span>        <span class="c1">; mask off all but red values</span>
                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%011100000000</span><span class="p">,</span> <span class="nb">d1</span>        <span class="c1">; mask off all but red values</span>

                <span class="k">cmp</span><span class="nd">.w </span>  <span class="nb">d1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; see if red is correct intensity</span>
                <span class="k">beq</span>     <span class="nv">red_fin</span>                   <span class="c1">; if not ...</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000100000000</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>      <span class="c1">; ... add one intensity of red</span>
<span class="nl">red_fin</span>
                <span class="k">rts</span>

<span class="nl">check_green</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                  <span class="c1">; move one final color into d0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a1</span><span class="p">),</span> <span class="nb">d1</span>                  <span class="c1">; move one temp color into d1</span>

                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000001110000</span><span class="p">,</span> <span class="nb">d0</span>        <span class="c1">; mask off all but green values</span>
                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000001110000</span><span class="p">,</span> <span class="nb">d1</span>        <span class="c1">; mask off all but green values</span>

                <span class="k">cmp</span><span class="nd">.w </span>  <span class="nb">d1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; see if green at correct intensity</span>
                <span class="k">beq</span>     <span class="nv">green_fin</span>                 <span class="c1">; if not ...</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000000010000</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>      <span class="c1">; ... add one intensity of green</span>
<span class="nl">green_fin</span>
                <span class="k">rts</span>

<span class="nl">check_blue</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                  <span class="c1">; move one final color into d0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a1</span><span class="p">),</span> <span class="nb">d1</span>                  <span class="c1">; move one temp color into d1</span>

                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000000000111</span><span class="p">,</span> <span class="nb">d0</span>        <span class="c1">; mask off all but blue values</span>
                <span class="k">and</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000000000111</span><span class="p">,</span> <span class="nb">d1</span>        <span class="c1">; mask off all but blue values</span>

                <span class="k">cmp</span><span class="nd">.w </span>  <span class="nb">d1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; see if blue at correct intensity</span>
                <span class="k">beq</span>     <span class="nv">blue_fin</span>                  <span class="c1">; if not ...</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mb">%000000000001</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>      <span class="c1">; ... add one intensity of blue</span>
<span class="nl">blue_fin</span>
                <span class="k">rts</span>

                <span class="kr">include</span> <span class="nv">initlib</span><span class="nd">.s
</span>
                <span class="kr">section</span> <span class="nv">data</span>

<span class="nl">old_70</span>          <span class="kt">dc</span><span class="nd">.l </span>   <span class="mi">0</span>
<span class="nl">picture</span>         <span class="kr">incbin</span>  <span class="nv">sleepsun</span><span class="p">.</span><span class="nv">pi1</span>
<span class="nl">counter</span>         <span class="kt">dc</span><span class="nd">.l </span>   <span class="mi">0</span>

                <span class="kr">section</span> <span class="nv">bss</span>
<span class="nl">pal</span>             <span class="kt">ds</span><span class="nd">.w </span>   <span class="mi">16</span>
<span class="nl">temp_pal</span>        <span class="kt">ds</span><span class="nd">.w </span>   <span class="mi">16</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/tutorial-15-screenshot.png" alt="tutorial 15 screenshot">
</div>
<div class="title">Figure 23. Fading</div>
</div>
<div class="paragraph">
<p>First I save the palette of the picture in a storage space, then I put the temporary palette in,
since the temporary palette is initialised to all 0&#8217;s, this has the effect of blacking out the
screen. Next I load up the picture as described in <a href="#">tutorial 6</a> and set up
the main routine.</p>
</div>
<div class="paragraph">
<p>The counter code is for delay purposes; otherwise the fade effect would hardly be visible. I
make <code>a0</code> point to the palette to reach, and point <code>a1</code> to the temporary one. Then I check the
individual intensities, and add 2 to each pointer in order to point to the next colour, repeating
this for the number of colours in the palette, namely 16.</p>
</div>
<div class="paragraph">
<p>You will notice that the check sub-routines are a bit different than the one described above, I
add to the value pointed to by <code>a1</code>, which is the current palette. It may be considered slightly
bad program habit to just assume that <code>a1</code> points to the current palette like that, but coding
demos and assembly in general depends on tight kept code that knows what it&#8217;s doing.
Besides, the tutorials aren&#8217;t really for teaching you how to make good code; they are
intended as basic introductions to various coding techniques.</p>
</div>
<div class="paragraph">
<p>That&#8217;s that, one easy effect achieved by manipulating the palette. If you want to fade to
white, just set the temporary palette to the real palette, and increment until you reach <code>$777</code>.
If you want to experiment, I suggest trying to implement the effect with a STe palette
instead, the included picture has a STe palette so it&#8217;s ready to go. This should involve shifting
the fourth bit of each colour intensity down as the first when adding to the colour intensity,
and then shift it back. For the next tutorial, I think we&#8217;ll handle full screen scrolling, without
moving any picture data!</p>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_of_using_the_gramophone.html">Of Using The Gramophone</a> | ↑ Up: <a href="index.html">The Atari ST MC68000 Assembly Language Tutorials</a> | Next: <a href="_appendixes.html">Appendixes</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1st edition (v0.84)<br>
Last updated 2022-04-18 16:48:36 UTC
</div>
</div>
</body>
</html>