<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="perihelion of poSTmortem">
<title>The Atari ST MC68000 Assembly Language Tutorials</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<a href="https://github.com/nguillaumin/perihelion-m68k-tutorials"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_of_using_the_gramophone" class="book toc2 toc-left">
<div id="header">
<h1>The Atari ST MC68000 Assembly Language Tutorials</h1>
<div class="details">
<span id="author" class="author">perihelion of poSTmortem</span><br>
<span id="revnumber">version 1st edition (v0.84),</span>
<span id="revdate">August 28th 2004 | edited by bp</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">The Atari ST MC68000 Assembly Language Tutorials</a></span></p><ul class="sectlevel1">
<li><a href="_foreword.html">Foreword</a>
</li>
<li><a href="_on_the_theory_behind_programming.html">On The Theory Behind Programming</a>
</li>
<li><a href="_of_the_workings_of_devpac_3_and_the_realisation_of_some_code.html">Of The Workings Of Devpac 3 And The Realisation Of Some Code</a>
</li>
<li><a href="_of_various_things_mystic_and_important_mainly_concerning_the_art_of_understanding_digits_and_performing_traps.html">Of Various Things Mystic And Important, Mainly Concerning The Art Of Understanding Digits And Performing Traps</a>
</li>
<li><a href="_of_the_ways_of_addressing_memory.html">Of The Ways Of Addressing Memory</a>
</li>
<li><a href="_of_the_workings_of_the_graphics_memory_and_minor_skills_in_branching.html">Of The Workings Of The Graphics Memory And Minor Skills In Branching</a>
</li>
<li><a href="_of_seeing_behind_the_curtain_of_an_execution_and_getting_intimate_with_files.html">Of Seeing Behind The Curtain Of An Execution And Getting Intimate With Files</a>
</li>
<li><a href="_on_scrollers.html">On Scrollers</a>
</li>
<li><a href="_of_scrolling_8_pixels_per_vbl_using_double_buffer.html">Of Scrolling 8 Pixels Per VBL Using Double Buffer</a>
</li>
<li><a href="_of_revealing_the_unseen_and_expanding_our_consciousness_without_the_use_of_illegal_drugs.html">Of Revealing The Unseen And Expanding Our Consciousness Without The Use Of Illegal Drugs</a>
</li>
<li><a href="_of_lighting_a_candle_and_casting_a_shadow.html">Of Lighting A Candle (And Casting A Shadow)</a>
</li>
<li><a href="_of_making_the_mountain_move_to_mohammed.html">Of Making The Mountain Move To Mohammed</a>
</li>
<li><a href="_of_controlling_the_puppets.html">Of Controlling The Puppets</a>
</li>
<li><a href="_of_hearing_that_which_is_spoken.html">Of Hearing That Which Is Spoken</a>
</li>
<li><a href="_of_using_the_gramophone.html"><span class="toc-current">Of Using The Gramophone</span></a>
</li>
<li><a href="_on_fading_to_black.html">On Fading To Black</a>
</li>
<li><a href="_appendixes.html">Appendixes</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_of_using_the_gramophone">Of Using The Gramophone</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>2003-02-22 (last edition of the initial revision)</em></p>
</div>
<div class="quoteblock">
<blockquote>
They fought like warrior poets. They fought like Scotsmen and
won their freedom forever.
</blockquote>
<div class="attribution">
&#8212; Braveheart
</div>
</div>
<div class="paragraph">
<p>Wow, it really was a long time since the last tutorial. I&#8217;ve had more and more to do in school
and other things have popped up, maybe I just needed a break too. Now I really feel up to
writing again, thanks to some encouragement on the Atari forum (<a href="http://www.atari-forum.com/" class="bare">http://www.atari-forum.com/</a>).</p>
</div>
<div class="paragraph">
<p>This here tutorial will be the follow up of the previous one, in which I promised to tell you
how to play the <code>.ym</code> files of the ST-sound format from Arnaud Carré. It will be quite easy and
a bit of a soft start actually. The focus lies not so much on the code, but how to find and
apply knowledge.</p>
</div>
<div class="paragraph">
<p>Like I always say, I am no musician, neither am I an artist, so therefore, I need to rip stuff or
have it made for me. I have loads of <code>.ym</code> files on my PC, which can be played by using a
plug-in for Winamp. Wouldn&#8217;t it be nice to be able to use this wealth of music? Yes it would, I
wonder how that can be achieved, here&#8217;s how.</p>
</div>
<div class="paragraph">
<p>In order to use the files, we need information on the file format. See <a href="#">tutorial 6</a>
for a quick refresh on files if that&#8217;s needed. Load up a good search engine in the browser,
I used Google (<a href="http://www.google.com/" class="bare">http://www.google.com/</a>). Now we want to find info on the <code>.ym</code> file format,
so a search string of "ym file format" would seem appropriate. Would you look at that, the
first find seems good, taking us to <a href="http://leonard.oxg.free.fr/ymformat.html" class="bare">http://leonard.oxg.free.fr/ymformat.html</a>. Quickly browsing
the side, we judge it seems to hold what we need. We also discover the file format is freeware,
so there&#8217;s no need to worry about the cops.
Hum hum, there seem to be different versions of the file format, didn&#8217;t know that&#8230;&#8203; hum
hum, this information only applies to YM6, the latest version. "So YM6 is just a register dump
file", this is an important key, it tells us how the file format works. It seems that an <code>.ym</code> file is
simply a dump of the data used to play a song, but that&#8217;s not enough, we need to know how
the data is organized. Reading on&#8230;&#8203; Ah, <code>.ym</code> files are packed using LHA, so that&#8217;s why they
are so small. Using the freeware UltimateZip (<a href="http://www.ultimatezip.com/" class="bare">http://www.ultimatezip.com/</a>), an <code>.ym</code> file can
be unpacked, or any other LHA packer, but UltimateZip is my choice of program.</p>
</div>
<div class="paragraph">
<p>Reading ever further down the page&#8230;&#8203; ah, here it comes. The <code>.ym</code> file contains 16 bytes of
data for each frame, interleaved. Sure, the sound chip has 16 registers, so by just putting the
data into the registers of the sound chip, music should be played. Lastly, there&#8217;s some info on
the file header. Some files have headers that tell of important information for the rest of the
file, here for example, it&#8217;s nice to know how long a song actually is. There&#8217;s some talk about
digi-drums and so, that will not be covered in this tutorial and you are welcome to explore it
yourself.</p>
</div>
<div class="paragraph">
<p>So, now we have all the information we need, we just have to structure it and go through it.
Load up the included <code>.ym</code> file <code>jamblv1.ym</code> in your favourite hex-editor. It&#8217;s also possible to
put it in an otherwise empty source file, assemble it and go into the debugger like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">nop</span>
<span class="nl">incbin</span>          <span class="nv">jamblv1</span><span class="p">.</span><span class="nv">ym</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Hex dump of the beginning of <code>jamblv1.ym</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">00000000</span>  <span class="mi">59</span> <span class="mi">4</span><span class="nv">d</span> <span class="mi">36</span> <span class="mi">21</span> <span class="mi">4</span><span class="nv">c</span> <span class="mi">65</span> <span class="mi">4</span><span class="nv">f</span> <span class="mi">6</span><span class="nv">e</span>  <span class="mi">41</span> <span class="mi">72</span> <span class="mi">44</span> <span class="mi">21</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">0</span><span class="nv">b</span> <span class="nv">ea</span>  <span class="o">|</span><span class="nv">YM6</span><span class="err">!</span><span class="nv">LeOnArD</span><span class="err">!</span><span class="p">....</span><span class="o">|</span>
<span class="nl">00000010</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">1</span><span class="nv">e</span>  <span class="mi">84</span> <span class="mi">80</span> <span class="mi">00</span> <span class="mi">32</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">...........</span><span class="mi">2</span><span class="p">....</span><span class="o">|</span>
<span class="nl">00000020</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">37</span> <span class="mi">20</span> <span class="mi">47</span> <span class="mi">61</span> <span class="mi">74</span> <span class="mi">65</span>  <span class="mi">73</span> <span class="mi">20</span> <span class="mi">6</span><span class="nv">f</span> <span class="mi">66</span> <span class="mi">20</span> <span class="mi">4</span><span class="nv">a</span> <span class="mi">61</span> <span class="mi">6</span><span class="nv">d</span>  <span class="o">|</span><span class="p">..</span><span class="mi">7</span> <span class="nv">Gates</span> <span class="nv">of</span> <span class="nv">Jam</span><span class="o">|</span>
<span class="nl">00000030</span>  <span class="mi">62</span> <span class="mi">61</span> <span class="mi">6</span><span class="nv">c</span> <span class="mi">61</span> <span class="mi">20</span> <span class="mi">4</span><span class="nv">c</span> <span class="mi">65</span> <span class="mi">76</span>  <span class="mi">65</span> <span class="mi">6</span><span class="nv">c</span> <span class="mi">20</span> <span class="mi">31</span> <span class="mi">00</span> <span class="mi">4</span><span class="nv">a</span> <span class="mi">6</span><span class="nv">f</span> <span class="mi">63</span>  <span class="o">|</span><span class="nv">bala</span> <span class="nv">Level</span> <span class="mi">1</span><span class="p">.</span><span class="nv">Joc</span><span class="o">|</span>
<span class="nl">00000040</span>  <span class="mi">68</span> <span class="mi">65</span> <span class="mi">6</span><span class="nv">e</span> <span class="mi">20</span> <span class="mi">48</span> <span class="mi">69</span> <span class="mi">70</span> <span class="mi">70</span>  <span class="mi">65</span> <span class="mi">6</span><span class="nv">c</span> <span class="mi">00</span> <span class="mi">43</span> <span class="mi">6</span><span class="nv">f</span> <span class="mi">6</span><span class="nv">e</span> <span class="mi">76</span> <span class="mi">65</span>  <span class="o">|</span><span class="nv">hen</span> <span class="nv">Hippel</span><span class="p">.</span><span class="nv">Conve</span><span class="o">|</span>
<span class="nl">00000050</span>  <span class="mi">72</span> <span class="mi">74</span> <span class="mi">65</span> <span class="mi">64</span> <span class="mi">20</span> <span class="mi">62</span> <span class="mi">79</span> <span class="mi">20</span>  <span class="mi">4</span><span class="nv">c</span> <span class="mi">65</span> <span class="mi">6</span><span class="nv">f</span> <span class="mi">6</span><span class="nv">e</span> <span class="mi">61</span> <span class="mi">72</span> <span class="mi">64</span> <span class="mi">00</span>  <span class="o">|</span><span class="nv">rted</span> <span class="nv">by</span> <span class="nv">Leonard</span><span class="p">.</span><span class="o">|</span>
<span class="nl">00000060</span>  <span class="nv">ed</span> <span class="nv">ec</span> <span class="nv">ec</span> <span class="nv">ed</span> <span class="nv">ee</span> <span class="nv">ef</span> <span class="nv">f0</span> <span class="nv">ef</span>  <span class="nv">ee</span> <span class="nv">ed</span> <span class="nv">ec</span> <span class="nv">ec</span> <span class="nv">ed</span> <span class="nv">ee</span> <span class="nv">ef</span> <span class="nv">f0</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">00000070</span>  <span class="nv">ef</span> <span class="nv">ee</span> <span class="nv">ed</span> <span class="nv">ec</span> <span class="nv">ec</span> <span class="nv">ed</span> <span class="nv">ee</span> <span class="nv">ef</span>  <span class="nv">f0</span> <span class="nv">ef</span> <span class="nv">ee</span> <span class="nv">ed</span> <span class="nv">ec</span> <span class="nv">ec</span> <span class="nv">ed</span> <span class="nv">ee</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">00000080</span>  <span class="nv">ef</span> <span class="nv">f0</span> <span class="nv">ef</span> <span class="nv">ee</span> <span class="nv">ed</span> <span class="nv">ec</span> <span class="nv">ec</span> <span class="nv">ed</span>  <span class="nv">ee</span> <span class="nv">ef</span> <span class="nv">f0</span> <span class="nv">ef</span> <span class="nv">ee</span> <span class="nv">ed</span> <span class="nv">ec</span> <span class="nv">ec</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">00000090</span>  <span class="nv">ed</span> <span class="nv">ee</span> <span class="nv">ef</span> <span class="nv">f0</span> <span class="nv">ef</span> <span class="nv">ee</span> <span class="nv">ed</span> <span class="nv">ec</span>  <span class="nv">ec</span> <span class="nv">ed</span> <span class="nv">ee</span> <span class="nv">ef</span> <span class="nv">f0</span> <span class="nv">ef</span> <span class="nv">ee</span> <span class="nv">ed</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It seems that every program starts with two bytes of data that would overwrite the data in
<code>jamblv1.ym</code>, that&#8217;s what the NOP is there for. By hitting tab once to get into the memory
window, you can use the arrow keys to scroll up and down in the <code>jamblv1.ym</code> file. Now we&#8217;ll
traverse the file and see if it corresponds to the information we have on what the file should
look like. It starts with the values <code>$59</code>, <code>$4d</code> and <code>$21</code>, which identifies the file as an YM6 file.
When interpreted as ASCII (numbers to letters), these numbers become the letters Y, M and
!. Next follows a test string, "LeOnArD!", all good so far.</p>
</div>
<div class="paragraph">
<p>After the initial check-things comes the interesting information, a long (4 bytes) that tells us
the number of frames in the file. In this case, it&#8217;s a value of <code>$0000bea</code>, which corresponds to
3050 in decimal. Note that I wrote out the leading two bytes that for now only contain zeros,
but they are important to count otherwise you&#8217;ll get lost. What does this mean exactly? Well,
frame of music is just like a frame of graphics, the ST usually operates at 50 Hertz which
equals 50 frames per second. So we divide 3050 by 50 and get the value 61, indicating the
tune should be 1:01 long. Load it up in Winamp to test, yep, seems to be right.</p>
</div>
<div class="paragraph">
<p>Next comes four bytes of song attributes, that I have no idea what it is, but zero seems to be
a safe value, and two bytes of digi-drums, which are also zero. Some files have a song
attribute of one, and they seem to work fine to. You&#8217;ll have to experiment with this yourself if
you find songs that should use digi-drums, or mail LeOnArD! Another uninteresting value,
<code>$001e8480</code>, or 2000000, which seems to indicate this is indeed an Atari tune. Then two
bytes, telling us the tune is operating at a frequency of 50 Hz. Lastly an additional six bytes
of zero data.</p>
</div>
<div class="paragraph">
<p>Right, you with me so far? It&#8217;s just a question of slowly going through the file and check that
everything is in order and corresponds to the information we have. Of course it is in order,
otherwise the file wouldn&#8217;t work in Winamp, but I want to make sure for myself. Now comes
some text again, according to Leonard&#8217;s page, these are the song name, author name and
song comment.</p>
</div>
<div class="paragraph">
<p>The data is in null terminated string format. This means the strings can be variable in length,
and ends with the value zero. Quite true, after each little string, we can see zeroes shining
through. After these strings, the real sound data begins, also of unknown length. However,
since we know that there are 3050 frames of data, and each frame holds 16 bytes of sound
data, there are 3050 × 16 = 48800 bytes of data here, this calculation also seems correct
since this is roughly the file size. At the end, there are also four bytes forming the string
"End!".</p>
</div>
<div class="listingblock">
<div class="title">Hex dump of the end of <code>jamblv1.ym</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">0000be80</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000be90</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000bea0</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000beb0</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000bec0</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000bed0</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000bee0</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000bef0</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>  <span class="o">|</span><span class="p">................</span><span class="o">|</span>
<span class="nl">0000bf00</span>  <span class="mi">45</span> <span class="mi">6</span><span class="nv">e</span> <span class="mi">64</span> <span class="mi">21</span>                                       <span class="o">|</span><span class="kr">End</span><span class="err">!</span><span class="o">|</span>
<span class="nl">0000bf04</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So what do we really need here? Two things, the number of frames, to know how long the
music file is, so we know when to terminate play, or loop the song, and the start address of
the music data. We know the address of the number of frames, so that&#8217;s easy to just store in
a variable. Getting to the music data is trickier, since we don&#8217;t know exactly where it is. Sure,
we can hexedit the file and then hardcode the address into the program, but a more general
way of finding the music start data would be nice, so that we easily can play many different
<code>.ym</code> files without having to check the start address of the sound data for each file.</p>
</div>
<div class="paragraph">
<p>What we want is to get to the end of the three text strings, because this is where the sound
data begins (if you don&#8217;t have any digi-drums). To do this, we put ourselves at the beginning
of the text field, which always start at the same place, and then we check each byte for a
zero, since this means the end of a string, and do this three times. In so doing, we will have
passed by all the three text strings, like so</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">ym_file</span><span class="p">,</span> <span class="nb">a0</span>              <span class="c1">; start of ym file</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="mi">12</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nv">frames</span>            <span class="c1">; store number of frames</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">34</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; beginning of text</span>

<span class="nl">song_name</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; search for 0</span>
                <span class="k">bne</span>     <span class="nv">song_name</span>
<span class="nl">comment</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; search for 0</span>
                <span class="k">bne</span>     <span class="nv">comment</span>
<span class="nl">song_data</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; search for 0</span>
                <span class="k">bne</span>     <span class="nv">song_data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nb">a0</span><span class="p">,</span> <span class="nv">music</span>                 <span class="c1">; skipped 3 zero, store address</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have the length of the tune in frames, and the start address for the sound data in
music. What was that about interleaved data? The thing is, that many registers of the sound
chip are all zero. In order to compress better, it would be nice to have all these zeros in one
long row. Therefore, the data is not presented in the order it&#8217;s supposed to be inserted in the
sound chip, rather, the data is presented one full register after another. Thus, in our file,
there is 3050 bytes of register 0 data, then 3050 bytes of register 1 data and so on.</p>
</div>
<div class="paragraph">
<p>When we put the sound data in the yammy, we have to add the number of frames for each
input. In this way, we will first input data from register 0, and then we skip the number of
frames to reach the data for the next register and so on. Here&#8217;s the entire code, the code for
the VU bars has already been discussed and is only included here for fun, so there is very
little new code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">jsr</span>     <span class="nv">initialise</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">palette</span><span class="p">,</span> <span class="nb">a0</span>              <span class="c1">; pointer to palette</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span>              <span class="c1">; palette in d0-d7</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="p">,</span> <span class="mh">$ff8240</span>            <span class="c1">; apply palette</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">ym_file</span><span class="p">,</span> <span class="nb">a0</span>              <span class="c1">; start of ym file</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="mi">12</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nv">frames</span>            <span class="c1">; store number of frames</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">34</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; beginning of text</span>

<span class="nl">song_name</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; search for 0</span>
                <span class="k">bne</span>     <span class="nv">song_name</span>
<span class="nl">comment</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; search for 0</span>
                <span class="k">bne</span>     <span class="nv">comment</span>
<span class="nl">song_data</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; search for 0</span>
                <span class="k">bne</span>     <span class="nv">song_data</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nb">a0</span><span class="p">,</span> <span class="nv">music</span>                 <span class="c1">; skipped 3 zero, store address</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$70</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>                <span class="c1">; backup $70</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="kr">main</span><span class="p">,</span> <span class="mh">$70</span>                <span class="c1">; start main routine</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">1</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a7</span>                    <span class="c1">; wait keypress</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="mh">$70</span>                <span class="c1">; restore $70</span>

                <span class="k">jsr</span>     <span class="nv">restore</span>

                <span class="k">clr</span><span class="nd">.l </span>  <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">1</span>                        <span class="c1">; exit</span>


<span class="nl">main</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="o">/</span><span class="nb">a0</span><span class="o">-</span><span class="nb">a6</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>        <span class="c1">; backup registers</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nv">music</span><span class="p">,</span> <span class="nb">a0</span>                 <span class="c1">; pointer to current music data</span>
                <span class="k">moveq</span><span class="nd">.l #</span><span class="mi">0</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; first yammy register</span>
<span class="nl">play</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="nb">d0</span><span class="p">,</span> <span class="mh">$ff8800</span>               <span class="c1">; write to register</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="mh">$ff8802</span>             <span class="c1">; write music data</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nv">frames</span><span class="p">,</span> <span class="nb">a0</span>                <span class="c1">; jump to next register in data</span>
                <span class="k">addq</span><span class="nd">.b </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; next register</span>
                <span class="k">cmp</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; see if last register</span>
                <span class="k">bne</span>     <span class="nv">play</span>                      <span class="c1">; if not, write next one</span>

                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">music</span>                 <span class="c1">; next set of registers</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">play_time</span>             <span class="c1">; 1/50th second play time</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nv">frames</span><span class="p">,</span> <span class="nb">d0</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nv">play_time</span><span class="p">,</span> <span class="nb">d1</span>
                <span class="k">cmp</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nb">d1</span>                    <span class="c1">; see if at end of music file</span>
                <span class="k">bne</span>     <span class="nv">no_loop</span>
                <span class="k">sub</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nv">music</span>                 <span class="c1">; beginning of music data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">play_time</span>             <span class="c1">; reset play time</span>
<span class="nl">no_loop</span>
                <span class="k">jsr</span>     <span class="nv">vu_bars</span>                   <span class="c1">; paint the vu bars</span>

                <span class="k">movem</span><span class="nd">.l </span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="o">/</span><span class="nb">a0</span><span class="o">-</span><span class="nb">a6</span>        <span class="c1">; restore registers</span>
                <span class="nv">rte</span>

<span class="c1">; put in VU bars</span>
<span class="nl">vu_bars</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$44e</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; get screen address</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">160</span><span class="o">*</span><span class="mi">199</span><span class="o">-</span><span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">160</span><span class="p">,</span> <span class="nb">a0</span>   <span class="c1">; bottom area of screen</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">bar</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; point to bar colours</span>

                <span class="kr">rept</span>    <span class="mi">15</span>                        <span class="c1">; 15 max volume</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d1</span>              <span class="c1">; VU bar colour in d1-d2</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d1</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span>               <span class="c1">; first VU bar</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; next VU bar</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d1</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span>               <span class="c1">; second VU bar</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; next VU bar</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d1</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span>               <span class="c1">; third VU bar</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="mi">320</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a0</span>               <span class="c1">; two lines down, two bars left</span>
                <span class="kr">endr</span>

<span class="c1">; delete VU bars depending on volume</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$44e</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; get screen address</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">160</span><span class="o">*</span><span class="mi">199</span><span class="o">-</span><span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">160</span><span class="p">,</span> <span class="nb">a0</span>   <span class="c1">; bottom area of screen</span>

                <span class="k">moveq</span><span class="nd">.l #</span><span class="mi">0</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; clear d0</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="mh">$ff8800</span>               <span class="c1">; chanenl a volume</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="mh">$ff8800</span><span class="p">,</span> <span class="nb">d0</span>               <span class="c1">; put volume in d0</span>
                <span class="k">jsr</span>     <span class="nv">del_bar</span>

                <span class="k">moveq</span><span class="nd">.l #</span><span class="mi">0</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; clear d0</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="nd">#</span><span class="mi">9</span><span class="p">,</span> <span class="mh">$ff8800</span>               <span class="c1">; channel b volume</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="mh">$ff8800</span><span class="p">,</span> <span class="nb">d0</span>               <span class="c1">; put volume in d0</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; next VU bar</span>
                <span class="k">jsr</span>     <span class="nv">del_bar</span>

                <span class="k">moveq</span><span class="nd">.l #</span><span class="mi">0</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; clear d0</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="nd">#</span><span class="mi">10</span><span class="p">,</span> <span class="mh">$ff8800</span>              <span class="c1">; channel c volume</span>
                <span class="k">move</span><span class="nd">.b </span> <span class="mh">$ff8800</span><span class="p">,</span> <span class="nb">d0</span>               <span class="c1">; put volume in d0</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; next VU bar</span>
                <span class="k">jsr</span>     <span class="nv">del_bar</span>

                <span class="k">rts</span>

<span class="nl">del_bar</span>
<span class="c1">; screen address of top line in a0</span>
<span class="c1">; volume in d0, gets detroyed</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nb">a0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>                 <span class="c1">; backup a0</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nb">a1</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>                 <span class="c1">; backup a1</span>
                <span class="k">and</span><span class="nd">.b </span>  <span class="nd">#</span><span class="mb">%1111</span><span class="p">,</span> <span class="nb">d0</span>                <span class="c1">; keep only lowest 4 bits</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">delete</span><span class="p">,</span> <span class="nb">a1</span>               <span class="c1">; beginning of delete blocks</span>
                <span class="k">mulu</span>    <span class="nd">#</span><span class="mi">12</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; length of one delete block</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; skip some delete instructions</span>
                <span class="k">jmp</span>     <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                      <span class="c1">; jump to correct delete position</span>

<span class="nl">delete</span>
                <span class="kr">rept</span>    <span class="mi">15</span>
                <span class="k">clr</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a0</span><span class="p">)</span>                      <span class="c1">; clear two bit planes</span>
                <span class="k">clr</span><span class="nd">.l </span>  <span class="mi">4</span><span class="p">(</span><span class="nb">a0</span><span class="p">)</span>                     <span class="c1">; clear two bit planes</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">320</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; hop two lines down</span>
                <span class="kr">endr</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">a1</span>                 <span class="c1">; restore a1</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">a0</span>                 <span class="c1">; restore a0</span>
                <span class="k">rts</span>


                <span class="kr">include</span> <span class="nv">initlib</span><span class="nd">.s
</span>
                <span class="kr">section</span> <span class="nv">data</span>
<span class="nl">music</span>           <span class="kt">dc</span><span class="nd">.l </span>   <span class="mi">0</span>                         <span class="c1">; address of music data</span>
<span class="nl">frames</span>          <span class="kt">dc</span><span class="nd">.l </span>   <span class="mi">0</span>                         <span class="c1">; how many frames of music data</span>
<span class="nl">play_time</span>       <span class="kt">dc</span><span class="nd">.l </span>   <span class="mi">0</span>                         <span class="c1">; how many VBL's has elapsed</span>

<span class="nl">ym_file</span>         <span class="kr">incbin</span>  <span class="nv">jamblv1</span><span class="p">.</span><span class="nv">ym</span>

<span class="nl">bar</span>
<span class="c1">; colour data for each line of VU bar</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$00ff</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span><span class="p">,</span> <span class="mh">$0000</span>

<span class="nl">palette</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$000</span><span class="p">,</span> <span class="mh">$023</span><span class="p">,</span> <span class="mh">$023</span><span class="p">,</span> <span class="mh">$024</span><span class="p">,</span> <span class="mh">$024</span><span class="p">,</span> <span class="mh">$025</span><span class="p">,</span> <span class="mh">$026</span><span class="p">,</span> <span class="mh">$026</span>
                <span class="kt">dc</span><span class="nd">.w </span>   <span class="mh">$027</span><span class="p">,</span> <span class="mh">$027</span><span class="p">,</span> <span class="mh">$227</span><span class="p">,</span> <span class="mh">$327</span><span class="p">,</span> <span class="mh">$427</span><span class="p">,</span> <span class="mh">$527</span><span class="p">,</span> <span class="mh">$627</span><span class="p">,</span> <span class="mh">$727</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/tutorial-14-screenshot.png" alt="tutorial 14 screenshot">
</div>
<div class="title">Figure 22. Music</div>
</div>
<div class="paragraph">
<p>I start off with a normal setup, then read in the music data as described previously and start
the main routine. The main routine here has the actual routine for playing the tune, and the
rest of the code is just VU bars.</p>
</div>
<div class="paragraph">
<p>First, make <code>a0</code> point to the current music data, this is somewhere in the music file (on a
number of frames boundary), then put the yammy register number in <code>d0</code>. The real routine for
actually getting the sound data into the yammy is very compact. <code>d0</code> holds the number of the
register to manipulate, putting that in <code>$ff8800</code> lets us manipulate the register in question,
then I just put in the music data. After that, it&#8217;s a question of adding the number of frames to
the music pointer, in order to point to the next register. Increment <code>d0</code> to point to the next
register, and do this 16 times, one time for each register. If you don&#8217;t remember about the
sound chip, recheck <a href="#">tutorial 13</a>.</p>
</div>
<div class="paragraph">
<p>Next I increment the music pointer, so that it points to the beginning of the next sound data
set, and increase the number of played frames by one. The last part of the main routine
checks to see if the number of played frames equals the number of frames, if this is so, I
subtract the number of frames from the music pointer. This makes the music pointer point to
the beginning of the music data again. The play time also needs to be reset of course, finally,
a jump to the VU routine, just for the visual effect. Not to complex when you think about it,
actually, I managed to get it right on the first compile&#8230;&#8203; almost, I had a slight offset error.</p>
</div>
<div class="paragraph">
<p>The routine should work for any and all YM6 version files without anything fancy (digi-drums
etc), and perhaps even with some fancy stuff. I don&#8217;t really know. Unfortunately it will not
play any other ym versions, you&#8217;ll have to work that out yourself. In order to get any music
you want from any Atari source, you can use SainT to record the music in <code>.ym</code> format, it&#8217;s
that simple.</p>
</div>
<div class="paragraph">
<p>With this routine, you could make yourself an <code>.ym</code> file player for the Atari. As the program is
now, it&#8217;s really crappy, there is no error reporting of any kind for starters. Perhaps some
tunes really are in 60 Hertz, then they would play wrongly, or perhaps the file is something
other than YM6 probably resulting in a crash. You should add some error reporting yourself.</p>
</div>
<div class="paragraph">
<p>One nice thing to do with this is to just hook up the music to the VBL, then drop out of the
program (not waiting for a key press nor restoring the VBL). The music will still be playing
and you can go on coding. This is very unstable though, and doing this in the GEM desktop
will probably get you an immediate crash, doing this in Devpac will probably get you a crash
when you compile anything. It&#8217;s just an idea to get you going.</p>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_of_hearing_that_which_is_spoken.html">Of Hearing That Which Is Spoken</a> | ↑ Up: <a href="index.html">The Atari ST MC68000 Assembly Language Tutorials</a> | Next: <a href="_on_fading_to_black.html">On Fading To Black</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1st edition (v0.84)<br>
Last updated 2022-04-23 15:26:12 UTC
</div>
</div>
</body>
</html>