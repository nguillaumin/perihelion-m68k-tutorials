<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="perihelion of poSTmortem">
<title>The Atari ST MC68000 Assembly Language Tutorials</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<a href="https://github.com/nguillaumin/perihelion-m68k-tutorials"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_of_making_the_mountain_move_to_mohammed" class="book toc2 toc-left">
<div id="header">
<h1>The Atari ST MC68000 Assembly Language Tutorials</h1>
<div class="details">
<span id="author" class="author">perihelion of poSTmortem</span><br>
<span id="revnumber">version 1st edition (v0.84),</span>
<span id="revdate">August 28th 2004 | edited by bp</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">The Atari ST MC68000 Assembly Language Tutorials</a></span></p><ul class="sectlevel1">
<li><a href="_foreword.html">Foreword</a>
</li>
<li><a href="_on_the_theory_behind_programming.html">On The Theory Behind Programming</a>
</li>
<li><a href="_of_the_workings_of_devpac_3_and_the_realisation_of_some_code.html">Of The Workings Of Devpac 3 And The Realisation Of Some Code</a>
</li>
<li><a href="_of_various_things_mystic_and_important_mainly_concerning_the_art_of_understanding_digits_and_performing_traps.html">Of Various Things Mystic And Important, Mainly Concerning The Art Of Understanding Digits And Performing Traps</a>
</li>
<li><a href="_of_the_ways_of_addressing_memory.html">Of The Ways Of Addressing Memory</a>
</li>
<li><a href="_of_the_workings_of_the_graphics_memory_and_minor_skills_in_branching.html">Of The Workings Of The Graphics Memory And Minor Skills In Branching</a>
</li>
<li><a href="_of_seeing_behind_the_curtain_of_an_execution_and_getting_intimate_with_files.html">Of Seeing Behind The Curtain Of An Execution And Getting Intimate With Files</a>
</li>
<li><a href="_on_scrollers.html">On Scrollers</a>
</li>
<li><a href="_of_scrolling_8_pixels_per_vbl_using_double_buffer.html">Of Scrolling 8 Pixels Per VBL Using Double Buffer</a>
</li>
<li><a href="_of_revealing_the_unseen_and_expanding_our_consciousness_without_the_use_of_illegal_drugs.html">Of Revealing The Unseen And Expanding Our Consciousness Without The Use Of Illegal Drugs</a>
</li>
<li><a href="_of_lighting_a_candle_and_casting_a_shadow.html">Of Lighting A Candle (And Casting A Shadow)</a>
</li>
<li><a href="_of_making_the_mountain_move_to_mohammed.html"><span class="toc-current">Of Making The Mountain Move To Mohammed</span></a>
</li>
<li><a href="_of_controlling_the_puppets.html">Of Controlling The Puppets</a>
</li>
<li><a href="_of_hearing_that_which_is_spoken.html">Of Hearing That Which Is Spoken</a>
</li>
<li><a href="_of_using_the_gramophone.html">Of Using The Gramophone</a>
</li>
<li><a href="_on_fading_to_black.html">On Fading To Black</a>
</li>
<li><a href="_appendixes.html">Appendixes</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_of_making_the_mountain_move_to_mohammed">Of Making The Mountain Move To Mohammed</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>2002-07-12 (last edition of the initial revision)</em></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Is it possible that we two, you and I, have grown so old and
inflexible that we have outlived our usefulness? Would that
constitute &#8230;&#8203; a joke?</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Star Trek VI<br>
<cite>the Undiscovered Country</cite>
</div>
</div>
<div class="paragraph">
<p>Well well, finally, as promised, we will delve into the technique of sprites; the essence of a
platform or shoot-em-up game, and lots of other stuff. In fact, anything that needs
something moving that is not 3D or real time rendered (that is, it&#8217;s being drawn while the
program runs, and not stored previously as a picture). It was really challenging and great fun
to code this one, and it&#8217;s probably the most satisfying coding experience ever, I hope I can
convey the knowledge it brought me.</p>
</div>
<div class="paragraph">
<p>In the last tutorial, we learned something on pixels, in order to be able to address a single
pixel anywhere, the data must be shifted into a correct position. Why is this? Because, each
instruction except the bit instructions, deal with at least byte size. What it means is that if we
use instructions with byte size, all pixels "snap" at 8 pixels, because that&#8217;s the minimum
addressable size. However, by shifting the data before using it in graphic instructions, we can
in a way address any pixel we want to.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/tutorial-11-autumn.gif" alt="tutorial 11 autumn">
</div>
<div class="title">Figure 12. autumn.pi1</div>
</div>
<div class="paragraph">
<p>I actually suggest you load up the pre-assembled program, and both the picture files that
comes with the tutorials, the pictures being <code>autumn.pi1</code> and <code>sprite.pi1</code>. A little note on the
pictures, they are in STe palette, meaning that they will look a bit ugly on a ST, but STeem
should handle this nicely. Yes, the character seen is the same one as in <a href="#">tutorial 9</a>:
Kenshin. He&#8217;s the main character in a Japanimation, a former assassin for the government who now tries to
atone by living a quiet life and helping people. This series is awesome and has given me
much inspiration, the first Kenshin OVA series is one of the most beautiful pieces of art I&#8217;ve
ever seen.</p>
</div>
<div id="sprite" class="imageblock">
<div class="content">
<img src="img/tutorial-11-sprite.gif" alt="tutorial 11 sprite">
</div>
<div class="title">Figure 13. sprite.pi1</div>
</div>
<div class="paragraph">
<p>So, after you&#8217;ve been impressed by the Tai Ji symbol (a.k.a. Yin and Yang symbol, Yin and Yo
in Japanese) bouncing around the screen, you are eager to learn for yourself, right? As you
can see, the background is provided in the <code>autumn.pi1</code>, and the bouncing ball, which is the
sprite, is in <code>sprite.pi1</code>. Actually, only 14 colours are used for the background, the last two
being reserved for the sprite, this isn&#8217;t necessary and the sprite may well share colours with
the background. The sprite seems to appear twice, in the <code>sprite.pi1</code>, there are two balls,
one of them is the sprite mask, if confusion occurs, just read on.</p>
</div>
<div class="paragraph">
<p>Painting the background is easy, just smack in the pixel data and set the palette, bouncing
will be dealt with later, what we need to focus on now is getting the sprite nicely on the
screen, and being able to put it anywhere on the screen, preferably expressing the location in
X and Y coordinates for human compatibility. How exactly to put the sprite data on screen,
the most obvious choice is a <code>move</code> instruction. This won&#8217;t do at all though, check this out.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Screen memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001110</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001011</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%01010101</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$0808595C</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Sprite data</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000001</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00100000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001010</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00208081</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now, if we move the sprite data onto the graphics memory, we get</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Screen memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000001</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00100000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001010</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00208081</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Move instructions destroy all data and replace it with new, in other words, the background is
completely lost and the sprite has taken over completely. Doing it like this will also create an
ugly squared looking sprite, since the sprite background will not be transparent (actually
rectangular, but more on this below), as you can see on <a href="_of_making_the_mountain_move_to_mohammed.html#moving-data">Result of simply `move&#8217;ing the sprite data"</a>. This will not do.</p>
</div>
<div id="moving-data" class="imageblock">
<div class="content">
<img src="img/tutorial-11-block.gif" alt="tutorial 11 block">
</div>
<div class="title">Figure 14. Result of simply `move&#8217;ing the sprite data"</div>
</div>
<div class="paragraph">
<p>OR instructions, on the other hand, will not overwrite the original data, we try an OR
instruction with the above configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Screen memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00100000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001011</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%01011111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$0828D9DD</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Dang! By ORing in the sprite, we mixed the sprite with the background, this is also bad since
the sprite will not look as it should, although it will create quite a nice effect and is good if
you simply want a "colour distortion" effect, but we don&#8217;t want that now (check <a href="_of_making_the_mountain_move_to_mohammed.html#or-ing">Using an OR instead</a> to
see the effect). An EOR would only flip the colours around in strange ways (<a href="_of_making_the_mountain_move_to_mohammed.html#eor-ing">An EOR is also no good&#8230;&#8203;</a>), and an
AND instruction clears data (<a href="_of_making_the_mountain_move_to_mohammed.html#and-ing">"&#8230;&#8203;as it isn&#8217;t an AND either"</a>).</p>
</div>
<div id="or-ing" class="imageblock">
<div class="content">
<img src="img/tutorial-11-or.gif" alt="tutorial 11 or">
</div>
<div class="title">Figure 15. Using an OR instead</div>
</div>
<div id="eor-ing" class="imageblock">
<div class="content">
<img src="img/tutorial-11-eor.gif" alt="tutorial 11 eor">
</div>
<div class="title">Figure 16. An EOR is also no good&#8230;&#8203;</div>
</div>
<div id="and-ing" class="imageblock">
<div class="content">
<img src="img/tutorial-11-and.gif" alt="tutorial 11 and">
</div>
<div class="title">Figure 17. "&#8230;&#8203;as it isn&#8217;t an AND either"</div>
</div>
<div class="paragraph">
<p>But wait, if we clear out the sprite data, with an AND, leaving the background intact, and
then OR in the sprite, it would all work. The sprite mask has the same look as the sprite, but
is only two colours. Colour 15 where the background is, making sure all bits there are set,
and colour 0 where the real sprite form is, making sure all bits are cleared. Have a look at
<a href="_of_making_the_mountain_move_to_mohammed.html#sprite">sprite.pi1</a> and you will see clearly (well, ok, in the picture, the mask
is colour 15 and the background is colour 0, but it will get inverted later, read on&#8230;&#8203; ).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Sprite mask</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11111111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11010100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11111111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11010100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11111111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11010100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11111111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%11010100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$FFFFFFFF</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$FF0F0F00</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All pixels that were colour 0 (background) in the sprite, are now colour 15 (<code>F</code>), and all pixels
that had one colour or another in the sprite are now colour 0. By ANDing the sprite mask with
the background, we will make sure to clear out all sprite pixels (since they get ANDed with 0)
and keeping the status of all other bits (since they are ANDed with 1). It is imperative that
you understand this step, if you don&#8217;t, reread the Boolean algebra part in <a href="#">tutorial 9</a>
check some external sources and think again, or send me an e-mail ☺. After applying the
mask, the screen memory will look like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Screen memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%01010100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$08080900</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">#bbbbbbbb</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">#bbsbsbss</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">b=background, s=sprite</p></td>
</tr>
</tbody>
</table>
<div id="mask" class="imageblock">
<div class="content">
<img src="img/tutorial-11-mask.gif" alt="tutorial 11 mask">
</div>
<div class="title">Figure 18. What the screen looks like, after the mask is applied.</div>
</div>
<div class="paragraph">
<p>As you can see (also in <a href="_of_making_the_mountain_move_to_mohammed.html#mask">What the screen looks like, after the mask is applied.</a>), the background has been preserved, while everything
concerning the sprite is wiped out. Now is the time to OR in the sprite data: this instruction
will in no way affect the background (since the background colour in the sprite is 0). This is
what it will look like after the OR operation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Screen memory</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000101</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00100000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%01011110</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Pixel colours</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$08288981</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">#bbbbbbbb</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">#bbsbsbss</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">b=background, s = sprite</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To summarise: first we take an inverted version of our sprite with only two colours, and AND
that with the background. This clears all pixels that are concerned with the sprite and leaves
the background intact. After the mask is applied, it is safe to OR in the sprite data, since after
the previous clearing of the sprite pixels, there is no risk of mixing the sprite with the
background. The background in the sprite is colour 0, thus the OR instruction will have no
effect on the background, the background part in the mask is colour 15 (all 1&#8217;s) and thus the
AND instruction will not affect the background.</p>
</div>
<div class="paragraph">
<p>OK, now we know how to put the sprite on screen, but we are still faced with the problem of
not being able to put it anywhere. To solve this, the sprite and mask data must be shifted.
Like with the putpixel, in order to put the sprite at say 0,2, we need to shift the sprite data
right two bits. With the putpixel, we shifted "real time", but there is much more data involved
in a sprite, so we&#8217;ll be pre-shifting the sprite instead. When using the pre-shifted method, we
assign a storage area that is 16 times larger than the sprite data, and store the sprite in that
area shifted in all possible sixteen combinations we need.</p>
</div>
<div class="paragraph">
<p>I see a big <code>?</code> in your face right now. Think about it, in the putpixel routine, we could end up
shifting the pixel 15 bits to the right, at most, so what we do here with the sprite is to store
all those possibilities after one another. When the time comes to put the sprite out, instead of
shifting the original sprite data, all we have to do is access the storage area with the correct
offset. An offset is the value added to the starting address of something. For example, the
middle of the screen is the screen address with an offset of 100 × 160 + 80 = 16080 bytes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Sprite data</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00001111</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Sprite storage area</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00001111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first position, offset 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000111</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second position, offset 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000011</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third position, offset 2</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">$00000001</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">fourth position, offset 3</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">(the offset number is completely fictional, it&#8217;s not even an even number)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s say we want to put the sprite at 0,2, we know what that means, it means point to the
start of the screen memory, shift the sprite data right by 2, and put it in place. Say <code>a0</code> points
to the screen memory, and <code>a1</code> to the sprite storage area, then we just need to add offset 2 to
<code>a1</code>, and a1 will point to correctly shifted sprite data. Pre-shifting is way faster than loading up
the sprite data in <code>a1</code>, and then shifting it, especially since the sprite data consists of several
words that all need to be shifted. The downside of course is loss of memory.</p>
</div>
<div class="paragraph">
<p>Now, there is a problem here, if we have a 32×32 pixel sprite, like in the sample program, the
data for the sprite is 16×32 bytes, arranged like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="3">Sprite data (W = word)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">First 16 pixels</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Last 16 pixels</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">&#8230;&#8203; and so on for a total of 32 lines</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When we begin to shift, we want the last bit that go out the first word, to be shifted in as the
first bit in the fifth word. This is comparable to the tutorials on scrolling. The last bit that goes
out the fifth word, should not go into the first bit of the ninth word, because then a pixel
from the first line would go into the second line, but there is no room to shift it out right on
the first line. So, we have to add a buffer to every line so that no data will be lost in the shift.
In the last shift, the first four words will be all but empty, and the buffer will be all but full. So
the sprite storage area will have to look like this.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="4">Sprite storage area (B=buffer, word size)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">First 16 pixels</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Middle 16 pixels</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Last 16 pixels</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">BBBB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">first line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">BBBB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">second line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WWWW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">BBBB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">third line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">&#8230;&#8203; and so on for a total of 32 lines and 16 such blocks to cover all possible shifts</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">FIXME</div>
<div class="paragraph">
<p>tut11blk.prg below</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Even though the sprite storage area covers a total of 48 pixels, 16 of these will be 0, thus not
affecting the background. See the sprite as a 48 pixel wide block, with only 32 pixels
coloured. Within this 48 pixel block, the 32 colour pixels will be shifted more and more to the
right as X coordinates increase, then when it becomes critical, the block will move 16 pixels to
the right in one sweep, and the 32 pixel colour area will be reset, starting the procedure all
over again. Run the <code>tut11blk.prg</code>, to see this clear.</p>
</div>
<div class="paragraph">
<p>Alright, theory part on pre-shifting done, now we need it in direct coding practice as well.
First off, we&#8217;ll need a good instruction with which to shift. Sure, <code>lsr</code> seems a good choice,
but we need to be able to preserve the bit that gets shifted out, and <code>lsr</code> doesn&#8217;t preserve
anything. The instruction <code>roxr</code>, for <strong>RO</strong>tate e<strong>X</strong>tended <strong>R</strong>ight, is good in this case. The
extended bit is rotated in from the left, and the bit rotated out the right is saved in the carry
and extended flag. So, by `roxr`ing with one each time, we will save what we shift out, and
shift it in the next time around (btw, when speaking about the user bits in the status register,
flags and bits are used synonymous). Looki looki:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top">d0</th>
<th class="tableblock halign-center valign-top">X (extended bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00001101</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>roxr #1,d0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%00000110</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>roxr #1,d0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%10000011</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>roxr #1,d0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">%01000001</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>What we do is to first copy the sprite data to the sprite storage area, then we take the data
from the storage area, rotate extended right with one, and save that data into the next
position of the storage area. What we have to think about when coding this is that the data
from the first word, goes into the fifth word and so on. In code, it looks like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">spr_dat</span><span class="p">,</span> <span class="nb">a0</span>             <span class="c1">; original sprite data</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">34</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; skip palette</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a1</span>              <span class="c1">; storage of pre-shifted sprite</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">first_sprite</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>             <span class="c1">; move from original to pre-shifted</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>             <span class="c1">; 32 pixels moved</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">a1</span>                   <span class="c1">; jump over end words</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">144</span><span class="p">,</span> <span class="nb">a0</span>                 <span class="c1">; jump to next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d0</span><span class="p">,</span> <span class="nv">first_sprite</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, point to the sprite data, jump over the palette and load up the sprite storage area,
which is a <code>ds.l 3072</code>: 16 bytes per line, plus 8 for the buffer, totalling 24 bytes per scan
line. The sprite is 32 lines and there should be 16 such blocks. This adds up to 24 × 32 × 16 =
12288 bytes, which is 3072 long words. In the loop, just copy data from the sprite picture to
the storage area, the buffer word area is skipped since it contains nothing at this time. Now
comes the challenging part, writing the generic pre-shift.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a0</span>              <span class="c1">; point to beginning of storage area</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a1</span>              <span class="c1">; point to beginning of storage area</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">768</span><span class="p">,</span> <span class="nb">a1</span>                 <span class="c1">; point to next sprite position</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">15</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d1</span>                <span class="c1">; 15 sprite positions left</span>
<span class="nl">positions</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d2</span>                <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">line</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d3</span>                 <span class="c1">; 4 bit planes</span>
<span class="nl">plane</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                 <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                 <span class="c1">; put it in place</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="mi">8</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">8</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">16</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>               <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">16</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>               <span class="c1">; put it in place</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; next bit plane, also clears X flag</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a1</span>                   <span class="c1">; next bit plane</span>

                <span class="k">dbf</span>     <span class="nb">d3</span><span class="p">,</span> <span class="nv">plane</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; next scan line</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; next scan line</span>

                <span class="k">dbf</span>     <span class="nb">d2</span><span class="p">,</span> <span class="nv">line</span>

                <span class="k">dbf</span>     <span class="nb">d1</span><span class="p">,</span> <span class="nv">positions</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First off, load up the storage area in <code>a0</code> and <code>a1</code>, and make a1 point to the next storage area.
This one is empty and should contain the sprite data shifted one bit to the right. Since we
have already filled the first position in the storage area, 15 positions are left. 32 lines to each
sprite and 4 bit planes to each line. Since all these are treated the same way, we only need
one big loop so to speak.</p>
</div>
<div class="paragraph">
<p>Now comes the fun part, put the first word in <code>d0</code>, this word comes from the previous storage
position. Rotate it, and put it in at the next storage position. Now the extended flag holds the
bit that was shifted out the right, and this one needs to be shifted in on the left in the first
word in the next word cluster. So, a byte offset of 8 (4 words) is added when fetching and
storing the next word. The buffer must also come into play, so the last word will get a byte
offset of 16. Now, we have pre-shifted three words.</p>
</div>
<div class="paragraph">
<p>By adding 2 to both <code>a1</code> and <code>a0</code> we will be at the next bit plane. It will also clear the extended
flag, which is good because otherwise a bit from the last word might come over to the first
word on the next bit plane, which is undesirable. Repeat for all four bit planes. We have now
moved a line of the sprite. After the four bit planes have been rotated, <code>a0</code> and <code>a1</code> will point to
the first word in the second 16 pixel cluster, or 8 bytes from the beginning of the data. By
adding 16, we will point to the next scan line (16+8 = 24). Repeat for 15 positions. Pretty
compact explanation, yes? A graphical representation follows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="4">Storage area with data, beginning at $0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 pixels</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">W W W W</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">W W W W</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">W W W W</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">&#8230;&#8203; for 32 lines</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0 2 4 6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8 10 12 14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 18 20 22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">byte offset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">Storage area without data, beginning at <code>$768</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 pixels</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0 0 0 0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0 0 0 0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0 0 0 0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(each 0 is word size)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">&#8230;&#8203; for 32 lines</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0 2 4 6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8 10 12 14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 18 20 22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">byte offset</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="c1">; a0 = $0</span>
                <span class="c1">; a1 = $768</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>
                <span class="k">roxr</span>    <span class="nb">d0</span>                       <span class="c1">; C = leftmost bit from W offset 0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                 <span class="c1">; put rotation in 0 at offset 0</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">8</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                <span class="c1">; as you see, first word of second cluster</span>
                <span class="k">roxr</span>    <span class="nb">d0</span>                       <span class="c1">; bit preserved and shifted from offset 0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">8</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                <span class="c1">; put it at offset 8</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">16</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>               <span class="c1">; first word last cluster</span>
                <span class="k">roxr</span>    <span class="nb">d0</span>                       <span class="c1">; rotate, carry bit may now be set</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">16</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>               <span class="c1">; at offset 16</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; next bit plane, watch offset</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a1</span>                   <span class="c1">; also clears X flag</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, <code>a0</code> and <code>a1</code> will both be at offset 8, the first word of the first bit plane, by adding 16 to
this, the offset will be 24, the value for a whole line, effectively putting us at the beginning of
the next line. That concludes the pre-shift of the sprite.</p>
</div>
<div class="paragraph">
<p>The mask data has to be pre-shifted a bit differently. Where the sprite colour is, we need the
mask to be 0, and where the background is, the mask must be 1, as explained above. A look
at the sprite picture will show that the sprite colour area is colour 15, all 1&#8217;s, and the
background is colour 0, all 0&#8217;s. For the mask to be correctly pre-shifted, we need to invert it,
making the background all 1&#8217;s and the sprite colour area all 0&#8217;s. When shifting, we must also
always be shifting in 1&#8217;s, not 0&#8217;s as the case was with the sprite data.</p>
</div>
<div class="paragraph">
<p>The instruction <code>not</code>, for NOT ☺, will take any value and invert it, this means changing all 1&#8217;s
to 0&#8217;s and all 0&#8217;s to 1&#8217;s. In order to have all bits except those concerning the sprite colour
area set, we must make sure to put 1&#8217;s in the buffer area. Also, at the beginning of each
plane loop, we must also make sure that the highest bit of <code>d0</code> is set, so that 1&#8217;s are shifted in.
Other than that, the sprite and mask pre-shift share ideas. The mask area is as big as the
sprite area. Even though this isn&#8217;t necessary since all bit planes in the sprite look alike, we
could have reduced the size by ¾, but for ease of understanding, this was not done.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">spr_dat</span><span class="p">,</span> <span class="nb">a0</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">34</span><span class="o">+</span><span class="mi">160</span><span class="o">*</span><span class="mi">32</span><span class="p">,</span> <span class="nb">a0</span>           <span class="c1">; skip palette and sprite</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a1</span>                <span class="c1">; load up mask part</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">first_mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>              <span class="c1">; move from original to pre-shifted</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                    <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                    <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                    <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                    <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mh">$ffffffff</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>        <span class="c1">; fill last two words...</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mh">$ffffffff</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>        <span class="c1">; ... with all 1's</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">144</span><span class="p">,</span> <span class="nb">a0</span>                 <span class="c1">; jump to next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d0</span><span class="p">,</span> <span class="nv">first_mask</span>
<span class="c1">; the picture mask has been copied to first position in pre-shift</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a0</span>                <span class="c1">; point to beginning of storage area</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a1</span>                <span class="c1">; point to beginning of storage area</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">768</span><span class="p">,</span> <span class="nb">a1</span>                 <span class="c1">; point to next mask position</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">15</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d1</span>                <span class="c1">; 15 sprite positions left</span>
<span class="nl">positions_mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d2</span>                <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">line_mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d3</span>                 <span class="c1">; 4 bit planes</span>
<span class="nl">plane_mask</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                 <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; pre-shift</span>
                <span class="k">or</span><span class="nd">.w </span>   <span class="nd">#</span><span class="mb">%1000000000000000</span><span class="p">,</span> <span class="nb">d0</span>   <span class="c1">; make sure most significant bit set</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                 <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">8</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">8</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">16</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>               <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">16</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>               <span class="c1">; put it in place</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a1</span>                   <span class="c1">; next bit plane</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; next plane, clears X flag (bad)</span>

                <span class="k">dbf</span>     <span class="nb">d3</span><span class="p">,</span> <span class="nv">plane_mask</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; next scan line</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; next scan line</span>

                <span class="k">dbf</span>     <span class="nb">d2</span><span class="p">,</span> <span class="nv">line_mask</span>

                <span class="k">dbf</span>     <span class="nb">d1</span><span class="p">,</span> <span class="nv">positions_mask</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike the sprite pre-shift where we could set up the storage area with direct memory moves
from the sprite picture to the storage area, here we move data, and then perform the NOT
instruction to invert the data. Also, instead of just skipping the buffer area like in the sprite,
here we fill it with 1&#8217;s. The bit plane loop is almost identical, with the one exception that the
first shift must be guaranteed to shift in a 1, not a 0. A simple OR instruction will make sure
the most significant bit is set. That was that, all pre-shifting done.</p>
</div>
<div class="paragraph">
<p>The method which we use to get the coordinates is the exact one found in Chapter 10. So
when we send in our coordinates, we will be provided with a pointer to the screen address,
and the number of shifts to be done in <code>d0</code>. The number in <code>d0</code> is an offset for the sprite data
and mask data. By putting the address to the sprite data in an address register, multiplying
<code>d0</code> with 768 and adding that to the address register, we will get a pointer to correctly shifted
sprite data. The reason for the number being 768 is that it is the size of a sprite block.</p>
</div>
<div class="paragraph">
<p>OK, now comes the problem of actually moving the sprite. We can put a sprite at any
coordinate we want, but we can&#8217;t move it yet. A simple bounce routine here, the sprite will
move with a certain X speed and a certain Y speed, and change direction when it hits "walls"
(edges of the screen). What we need is a heading, and a speed. For simplicity, we express
the heading as either 1 or 0 for both X and Y respectively. 1 is towards bottom right and 0 is
towards upper left. X heading is either right or left, and Y heading either up or down. The X
and Y speed is how many pixels to move the sprite in desired direction each VBL. So with an
X heading of 1, and an X speed of 2, the sprite would move 2 pixels right each VBL.</p>
</div>
<div class="paragraph">
<p>What the move routine needs to do is to add X and Y coordinates in accordance with heading
and speed, as well as checking for wall hits. When a wall hit occurs, the sprite must change
direction. A change in direction simply means flipping between 1 or 0 in heading. This might
be a good time to tell about the <code>equ</code>, for <strong>EQU</strong>als method. Any label can have an <code>equ</code> applied
to it, meaning that whenever one uses the label, it is replaced by the <code>equ</code>. Easy huh?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">number</span>          <span class="kr">equ</span>     <span class="mi">2</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">number</span><span class="p">,</span> <span class="nb">d0</span>              <span class="c1">; same as move.l #2,d0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One can say that `equ&#8217;s, are constants. It&#8217;s good practice to have as many `equ&#8217;s as possible,
because if you realize you have to change a constant, you only need to change it in one place
instead of every place the constant appears. X speed and Y speed is a good example (unless
you want variable speed), X coordinate is a terrible thing, since it needs to change all the
time. Actually, I think it&#8217;s best to express the move routine in pseudo code first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">If</span> <span class="p">(</span><span class="nv">x_coord</span> <span class="o">&gt;</span> <span class="mi">319</span> <span class="o">-</span> <span class="mi">32</span> <span class="o">-</span> <span class="nv">x_speed</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">Then</span>
        <span class="nv">x_heading</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nl">If</span> <span class="p">(</span><span class="nv">x_coord</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">Then</span>
        <span class="nv">x_heading</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nl">If</span> <span class="p">(</span><span class="nv">y_coord</span> <span class="o">&gt;</span> <span class="mi">199</span> <span class="o">-</span> <span class="mi">32</span> <span class="o">-</span> <span class="nv">y_speed</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">Then</span>
        <span class="nv">y_heading</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nl">If</span> <span class="p">(</span><span class="nv">y_coord</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">Then</span>
        <span class="nv">y_heading</span> <span class="o">=</span> <span class="mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First we check to see if the heading needs change, as long as the sprite is in any way outside
the screen coordinates, we need to change the heading. Since we check the heading before
we move the sprite, and move the sprite before drawing it, the sprite will never be drawn off
screen. The only trouble here is where all numbers come from. Think of it first without
<code>x_speed</code> added, every VBL the sprite just moves one pixel. Then the formula is <code>x_coord</code> &gt;
319 - 32. This is easy to grasp, the X coordinate must not be more than the screen can hold,
which is 319, minus the width of the sprite itself of course, which is 32.</p>
</div>
<div class="paragraph">
<p>The so called "hot spot" of the sprite is the upper left corner. This is the point against which
all sprite coordinates are measured. We say that the sprite is at coordinates 13,13, but this
really means that the sprite hot spot is at 13,13. Exactly what pixels the sprite inhabits is
unknown to us, since the sprite can have any form, but for simplicity, we think of the sprite
as a square, with the coordinates in the upper left corner. Thus, when seeing if the sprite hits
the right wall, we take the coordinates of the upper left corner, the hot spot, and add the
width of the sprite.</p>
</div>
<div class="paragraph">
<p>The <code>x_speed</code> is also to be taken into account. Imagine the sprite moving with 100 pixels per
VBL, then the sprite will be way outside the screen if it&#8217;s anywhere over the right half of the
screen, so the sprite is only ok if it&#8217;s on the left half of the screen, obviously, the speed must
be taken into account. Think of the speed as just enlargement to the sprite. The Y check
works exactly the same way, but with a different max coordinate for obvious reasons. It looks
a bit different in assembly though.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">319</span><span class="o">-</span><span class="mi">32</span><span class="o">-</span><span class="nv">x_speed</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nv">x_coord</span>

                <span class="k">blt</span>     <span class="nv">x_right_ok</span>               <span class="c1">; see if x is &lt; 319-32 for width</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">x_heading</span>            <span class="c1">; if x &gt;=319, change heading</span>
<span class="nl">x_right_ok</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">x_coord</span>
                <span class="k">bgt</span>     <span class="nv">x_left_ok</span>                <span class="c1">; see if x is &gt; 0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">x_heading</span>            <span class="c1">; if x &lt;=0, change heading</span>
<span class="nl">x_left_ok</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">199</span><span class="o">-</span><span class="mi">32</span><span class="o">-</span><span class="nv">y_speed</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nv">y_coord</span>
                <span class="k">blt</span>     <span class="nv">y_low_ok</span>                 <span class="c1">; see if y is &lt; 199-32 for lines</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y_heading</span>            <span class="c1">; if y &gt;=199, change heading</span>
<span class="nl">y_low_ok</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y_coord</span>
                <span class="k">bgt</span>     <span class="nv">y_high_ok</span>                <span class="c1">; see if y is &gt; 0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">y_heading</span>            <span class="c1">; if y &lt;=0, change heading</span>
<span class="nl">y_high_ok</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We check if the X coordinate is lesser than the number, and if it is, it&#8217;s ok and a little branch
will skip the changing of the X heading. Whereas the pseudo code&#8217;s IF statements took place
if the check was true, our checks affect if the statements are false. This may look messy, but
it&#8217;s really quite simple, just take a second look at it. We also need to update the coordinates,
here&#8217;s some more pseudo code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">If</span> <span class="p">(</span><span class="nv">x_heading</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">Then</span>
        <span class="nv">x_coordinate</span> <span class="o">=</span> <span class="nv">x_coordinate</span> <span class="o">-</span> <span class="nv">x_speed</span>
<span class="nl">Else</span>
        <span class="nv">x_coordinate</span> <span class="o">=</span> <span class="nv">x_coordinate</span> <span class="o">+</span> <span class="nv">x_speed</span>

<span class="nl">If</span> <span class="p">(</span><span class="nv">y_heading</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">Then</span>
        <span class="nv">y_coordinate</span> <span class="o">=</span> <span class="nv">y_coordinate</span> <span class="o">-</span> <span class="nv">y_speed</span>
<span class="nl">Else</span>
        <span class="nv">y_coordinate</span> <span class="o">=</span> <span class="nv">y_coordinate</span> <span class="o">+</span> <span class="nv">y_speed</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No problem there, just change the coordinates according to speed and heading. In assembly
it becomes more troublesome though.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k">                <span class="k">cmp</span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">x_heading</span>                <span class="c1">; check x heading</span>
                <span class="k">bne</span> <span class="nv">x_move_right</span>                 <span class="c1">; if 1, move right, otherwise left</span>
                <span class="k">sub</span><span class="nd">.w #</span><span class="nv">x_speed</span><span class="p">,</span> <span class="nv">x_coord</span>          <span class="c1">; move sprite left</span>
                <span class="k">bra</span> <span class="nv">x_move_done</span>                  <span class="c1">; done moving sprite in x</span>
<span class="nl">x_move_right</span>
                <span class="k">add</span><span class="nd">.w #</span><span class="nv">x_speed</span><span class="p">,</span> <span class="nv">x_coord</span>          <span class="c1">; move sprite right</span>
<span class="nl">x_move_done</span>

                <span class="k">cmp</span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y_heading</span>                <span class="c1">; check y heading</span>
                <span class="k">bne</span> <span class="nv">y_move_down</span>                  <span class="c1">; if 1, move down, otherwise up</span>
                <span class="k">sub</span><span class="nd">.w #</span><span class="nv">y_speed</span><span class="p">,</span> <span class="nv">y_coord</span>          <span class="c1">; move sprite up</span>
                <span class="k">bra</span> <span class="nv">y_move_done</span>                  <span class="c1">; done moving sprite in y</span>
<span class="nl">y_move_down</span>
                <span class="k">add</span><span class="nd">.w #</span><span class="nv">y_speed</span><span class="p">,</span> <span class="nv">y_coord</span>          <span class="c1">; move sprite down</span>
<span class="nl">y_move_done</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, a check to see if X heading is 0, if it is, move to the left, otherwise move to the right. If
we move to the left, we subtract the X coordinate by the X speed, and we must also make
sure to jump past the move to the right. The Y part is exactly as the X part. Again, just look
one more time at the code and if it seems confusing, write it down on paper if you must and
go through the different possible branches, it&#8217;s not too complex once you structuralize it.</p>
</div>
<div class="paragraph">
<p>Hoah, this takes time to explain, hope you&#8217;re still with me 'cus we are almost done. Now we
know how to pre-shift, apply the sprite and move it. One would think that we have all we
need, there is just one more thing to take into account. If we would apply the things we
know and fire away, we would have a sprite that moves over the screen and leaves a trail.</p>
</div>
<div class="paragraph">
<p>The damn thing will never go away, making it most ugly. Why? Because the background must
be restored when the sprite has passed it.</p>
</div>
<div class="paragraph">
<p>So, on every VBL, the background must first be restored, then it must be saved after the
sprite coordinates are updated, since the save and restore routine is dependent on the sprite
coordinates. Then we can paint the sprite. The save routine just copies a sprite sized block
from the screen memory into a save buffer, and the restore routine copies the data from the
buffer onto the screen.</p>
</div>
<div class="paragraph">
<p>What we have now is a main routine that restores background, moves the sprite (rather
updates the sprite coordinates), saves the background, applies the mask and lastly paints the
sprite. All of this is so fast, that we don&#8217;t even have to bother with double buffering, so we
pull a fast one and just skip that. Here comes the entire source code, don&#8217;t panic, most of the
stuff will be familiar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="m68k"><span class="nl">x_speed</span>         <span class="kr">equ</span>     <span class="mi">2</span>                         <span class="c1">; how many x coord to move each VBL</span>
<span class="nl">y_speed</span>         <span class="kr">equ</span>     <span class="mi">1</span>                         <span class="c1">; how many y coord to move each VBL</span>

                <span class="k">jsr</span>     <span class="nv">initialise</span>

<span class="c1">; pre-shifting sprite</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">spr_dat</span><span class="p">,</span> <span class="nb">a0</span>              <span class="c1">; original sprite data</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">34</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; skip palette</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a1</span>               <span class="c1">; storage of pre-shifted sprite</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                 <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">first_sprite</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>              <span class="c1">; move from original to pre-shifted</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>              <span class="c1">; 32 pixels moved</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; jump over end words</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">144</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; jump to next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d0</span><span class="p">,</span> <span class="nv">first_sprite</span>
<span class="c1">; the picture sprite has been copied to first position in pre-shift</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a0</span>               <span class="c1">; point to beginning of storage area</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a1</span>               <span class="c1">; point to beginning of storage area</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">768</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; point to next sprite position</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">15</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d1</span>                 <span class="c1">; 15 sprite positions left</span>
<span class="nl">positions</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d2</span>                 <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">line</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d3</span>                  <span class="c1">; 4 bit planes</span>
<span class="nl">plane</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                  <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                  <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">8</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                 <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">8</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                 <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">16</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">16</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                <span class="c1">; put it in place</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; next bit plane, also clears X flag</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; next bit plane</span>

                <span class="k">dbf</span>     <span class="nb">d3</span><span class="p">,</span> <span class="nv">plane</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; next scan line</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a1</span>                   <span class="c1">; next scan line</span>

                <span class="k">dbf</span>     <span class="nb">d2</span><span class="p">,</span> <span class="nv">line</span>

                <span class="k">dbf</span>     <span class="nb">d1</span><span class="p">,</span> <span class="nv">positions</span>
<span class="c1">; pre-shift of sprite done, all 16 sprite possitions saved in sprite</span>


<span class="c1">; pre-shifting mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">spr_dat</span><span class="p">,</span> <span class="nb">a0</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">34</span><span class="o">+</span><span class="mi">160</span><span class="o">*</span><span class="mi">32</span><span class="p">,</span> <span class="nb">a0</span>            <span class="c1">; skip palette and sprite</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a1</span>                 <span class="c1">; load up mask part</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                 <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">first_mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>               <span class="c1">; move from original to pre-shifted</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                     <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                     <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                     <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>               <span class="c1">;</span>
                <span class="k">not</span><span class="nd">.l </span>  <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                     <span class="c1">; invert the mask data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mh">$ffffffff</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>         <span class="c1">;  fill last two words...</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mh">$ffffffff</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>         <span class="c1">;  ... with all 1's</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">144</span><span class="p">,</span> <span class="nb">a0</span>                  <span class="c1">; jump to next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d0</span><span class="p">,</span> <span class="nv">first_mask</span>
<span class="c1">; the picture mask has been copied to first position in pre-shift</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a0</span>                 <span class="c1">; point to beginning of storage area</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a1</span>                 <span class="c1">; point to beginning of storage area</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">768</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; point to next mask position</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">15</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d1</span>                 <span class="c1">; 15 sprite positions left</span>
<span class="nl">positions_mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d2</span>                 <span class="c1">; 32 scan lines per sprite</span>
<span class="nl">line_mask</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d3</span>                  <span class="c1">; 4 bit planes</span>
<span class="nl">plane_mask</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                  <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; pre-shift</span>
                <span class="k">or</span><span class="nd">.w </span>   <span class="nd">#</span><span class="mb">%1000000000000000</span><span class="p">,</span> <span class="nb">d0</span>    <span class="c1">; make sure most significant bit set</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                  <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">8</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                 <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">8</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                 <span class="c1">; put it in place</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="mi">16</span><span class="p">(</span><span class="nb">a0</span><span class="p">),</span> <span class="nb">d0</span>                <span class="c1">; move one word</span>
                <span class="k">roxr</span>    <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d0</span>                    <span class="c1">; pre-shift</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="mi">16</span><span class="p">(</span><span class="nb">a1</span><span class="p">)</span>                <span class="c1">; put it in place</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; next bit plane, clears X flag (bad)</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; next bit plane</span>

                <span class="k">dbf</span>     <span class="nb">d3</span><span class="p">,</span> <span class="nv">plane_mask</span>

                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a0</span>                   <span class="c1">; next scan line</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">a1</span>                   <span class="c1">; next scan line</span>

                <span class="k">dbf</span>     <span class="nb">d2</span><span class="p">,</span> <span class="nv">line_mask</span>

                <span class="k">dbf</span>     <span class="nb">d1</span><span class="p">,</span> <span class="nv">positions_mask</span>
<span class="c1">; pre-shift of mask done, all 16 sprite possitions saved in mask</span>

                <span class="k">movem</span><span class="nd">.l </span><span class="nv">bg</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="p">,</span> <span class="mh">$ff8240</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">bg</span><span class="o">+</span><span class="mi">34</span><span class="p">,</span> <span class="nb">a0</span>                <span class="c1">; pixel part of background</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$44e</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; put screen memory in a1</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">7999</span><span class="p">,</span> <span class="nb">d0</span>                 <span class="c1">; 8000 longwords to a screen</span>
<span class="nl">pic_loop</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>              <span class="c1">; move one longword to screen</span>
                <span class="k">dbf</span>     <span class="nb">d0</span><span class="p">,</span> <span class="nv">pic_loop</span>              <span class="c1">; background painted</span>

                <span class="k">jsr</span>     <span class="nv">save_background</span>           <span class="c1">; something in restore buffer</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$70</span><span class="p">,</span> <span class="nv">old_70</span>               <span class="c1">; backup $70</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="kr">main</span><span class="p">,</span> <span class="mh">$70</span>                <span class="c1">; put in main routine</span>

                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">1</span>
                <span class="k">addq</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">2</span><span class="p">,</span> <span class="nb">a7</span>                    <span class="c1">; wait keypress</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nv">old_70</span><span class="p">,</span> <span class="mh">$70</span>               <span class="c1">; restore old $70</span>

                <span class="k">jsr</span>     <span class="nv">restore</span>

                <span class="k">clr</span><span class="nd">.l </span>  <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>
                <span class="k">trap</span>    <span class="nd">#</span><span class="mi">1</span>                        <span class="c1">; exit</span>

<span class="nl">main</span>
                <span class="k">movem</span><span class="nd">.l </span><span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="o">/</span><span class="nb">a0</span><span class="o">-</span><span class="nb">a6</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span>        <span class="c1">; backup registers</span>

                <span class="k">jsr</span>     <span class="nv">restore_background</span>
                <span class="k">jsr</span>     <span class="nv">move_sprite</span>
                <span class="k">jsr</span>     <span class="nv">save_background</span>
                <span class="k">jsr</span>     <span class="nv">apply_mask</span>
                <span class="k">jsr</span>     <span class="nv">put_sprite</span>

                <span class="k">movem</span><span class="nd">.l </span><span class="p">(</span><span class="nb">a7</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span><span class="o">-</span><span class="nb">d7</span><span class="o">/</span><span class="nb">a0</span><span class="o">-</span><span class="nb">a6</span>        <span class="c1">; restore registers</span>

                <span class="nv">rte</span>

<span class="nl">move_sprite</span>
<span class="c1">; moves the sprite one pixel in x and y</span>
<span class="c1">; see if any headings need to be changed</span>
                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">319</span><span class="o">-</span><span class="mi">32</span><span class="o">-</span><span class="nv">x_speed</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nv">x_coord</span>
                <span class="k">blt</span>     <span class="nv">x_right_ok</span>                <span class="c1">; see if x is &lt; 319-32 for width</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">x_heading</span>             <span class="c1">; if x &gt;=319, change heading</span>
<span class="nl">x_right_ok</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">x_coord</span>
                <span class="k">bgt</span>     <span class="nv">x_left_ok</span>                 <span class="c1">; see if x is &gt; 0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">x_heading</span>             <span class="c1">; if x &lt;=0, change heading</span>
<span class="nl">x_left_ok</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">199</span><span class="o">-</span><span class="mi">32</span><span class="o">-</span><span class="nv">y_speed</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nv">y_coord</span>
                <span class="k">blt</span>     <span class="nv">y_low_ok</span>                  <span class="c1">; see if y is &lt; 199-32 for lines</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y_heading</span>             <span class="c1">; if y &gt;=199, change heading</span>
<span class="nl">y_low_ok</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y_coord</span>
                <span class="k">bgt</span>     <span class="nv">y_high_ok</span>                 <span class="c1">; see if y is &gt; 0</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">1</span><span class="p">,</span> <span class="nv">y_heading</span>             <span class="c1">; if y &lt;=0, change heading</span>
<span class="nl">y_high_ok</span>
<span class="c1">; all eventual heading changes now made</span>

<span class="c1">; move sprite coordinates (change coordinates)</span>
                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">x_heading</span>             <span class="c1">; check x heading</span>
                <span class="k">bne</span>     <span class="nv">x_move_right</span>              <span class="c1">; if 1, move right, otherwise left</span>
                <span class="k">sub</span><span class="nd">.w </span>  <span class="nd">#</span><span class="nv">x_speed</span><span class="p">,</span> <span class="nv">x_coord</span>         <span class="c1">; move sprite left</span>
                <span class="k">bra</span>     <span class="nv">x_move_done</span>               <span class="c1">; done moving sprite in x</span>
<span class="nl">x_move_right</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="nv">x_speed</span><span class="p">,</span> <span class="nv">x_coord</span>         <span class="c1">; move sprte right</span>
<span class="nl">x_move_done</span>

                <span class="k">cmp</span>     <span class="nd">#</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y_heading</span>             <span class="c1">; check y heading</span>
                <span class="k">bne</span>     <span class="nv">y_move_down</span>               <span class="c1">; if 1, move down, otherwise up</span>
                <span class="k">sub</span><span class="nd">.w </span>  <span class="nd">#</span><span class="nv">y_speed</span><span class="p">,</span> <span class="nv">y_coord</span>         <span class="c1">; move sprite up</span>
                <span class="k">bra</span>     <span class="nv">y_move_done</span>               <span class="c1">; done moving sprite in y</span>
<span class="nl">y_move_down</span>
                <span class="k">add</span><span class="nd">.w </span>  <span class="nd">#</span><span class="nv">y_speed</span><span class="p">,</span> <span class="nv">y_coord</span>         <span class="c1">; move sprte down</span>
<span class="nl">y_move_done</span>
<span class="c1">; finnished moving sprite</span>

                <span class="k">rts</span>

<span class="nl">apply_mask</span>
<span class="c1">; applies the mask to the background</span>
                <span class="k">jsr</span>     <span class="nv">get_coordinates</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">mask</span><span class="p">,</span> <span class="nb">a0</span>
                <span class="k">mulu</span>    <span class="nd">#</span><span class="mi">768</span><span class="p">,</span> <span class="nb">d0</span>                  <span class="c1">; multiply position with size</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; add value to mask pointer</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d7</span>                 <span class="c1">; mask is 32 scan lines</span>
<span class="nl">maskloop</span>
                <span class="kr">rept</span>    <span class="mi">6</span>                         <span class="c1">; mask is 6*4 bytes width</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span>                 <span class="c1">; mask data in d0</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a1</span><span class="p">),</span> <span class="nb">d1</span>                  <span class="c1">; background data in d1</span>
                <span class="k">and</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nb">d1</span>                    <span class="c1">; and mask and picture data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nb">d1</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; move masked data to background</span>
                <span class="kr">endr</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">136</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d7</span><span class="p">,</span> <span class="nv">maskloop</span>

                <span class="k">rts</span>

<span class="nl">put_sprite</span>
<span class="c1">; paints the sprite to the screen</span>
                <span class="k">jsr</span>     <span class="nv">get_coordinates</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">sprite</span><span class="p">,</span> <span class="nb">a0</span>
                <span class="k">mulu</span>    <span class="nd">#</span><span class="mi">768</span><span class="p">,</span> <span class="nb">d0</span>                  <span class="c1">; multiply position with size</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nb">a0</span>                    <span class="c1">; add value to sprite pointer</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d7</span>                 <span class="c1">; sprite is 32 scan lines</span>
<span class="nl">bgloop</span>
                <span class="kr">rept</span>    <span class="mi">6</span>                         <span class="c1">; sprite is 6*4 bytes width</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="nb">d0</span>                 <span class="c1">; sprite data in d0</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a1</span><span class="p">),</span> <span class="nb">d1</span>                  <span class="c1">; background data in d1</span>
                <span class="k">or</span><span class="nd">.l </span>   <span class="nb">d0</span><span class="p">,</span> <span class="nb">d1</span>                    <span class="c1">; or sprite and background data</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nb">d1</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>                 <span class="c1">; move ored sprite data to background</span>
                <span class="kr">endr</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">136</span><span class="p">,</span> <span class="nb">a1</span>
                <span class="k">dbf</span>     <span class="nb">d7</span><span class="p">,</span> <span class="nv">bgloop</span>

                <span class="k">rts</span>

<span class="nl">save_background</span>
<span class="c1">; saves the background into bgsave</span>
                <span class="k">jsr</span>     <span class="nv">get_coordinates</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">bgsave</span><span class="p">,</span> <span class="nb">a0</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d7</span>                 <span class="c1">; sprite is 32 scan lines</span>
<span class="nl">bgsaveloop</span>
                <span class="kr">rept</span>    <span class="mi">6</span>                         <span class="c1">; sprite is 6*4 bytes width</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span>              <span class="c1">; copy background to save buffer</span>
                <span class="kr">endr</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">136</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d7</span><span class="p">,</span> <span class="nv">bgsaveloop</span>

                <span class="k">rts</span>

<span class="nl">restore_background</span>
<span class="c1">; restores the background using data from bgsave</span>
                <span class="k">jsr</span>     <span class="nv">get_coordinates</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="nv">bgsave</span><span class="p">,</span> <span class="nb">a0</span>

                <span class="k">move</span><span class="nd">.l </span> <span class="nd">#</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">d7</span>                 <span class="c1">; sprite is 32 scan lines</span>
<span class="nl">bgrestoreloop</span>
                <span class="kr">rept</span>    <span class="mi">6</span>                         <span class="c1">; sprite is 6*4 bytes width</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="p">(</span><span class="nb">a0</span><span class="p">)</span><span class="o">+</span><span class="p">,</span> <span class="p">(</span><span class="nb">a1</span><span class="p">)</span><span class="o">+</span>              <span class="c1">; copy save buffer to background</span>
                <span class="kr">endr</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nd">#</span><span class="mi">136</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; next scan line</span>
                <span class="k">dbf</span>     <span class="nb">d7</span><span class="p">,</span> <span class="nv">bgrestoreloop</span>

                <span class="k">rts</span>

<span class="nl">get_coordinates</span>
<span class="c1">; makes a1 point to correct place on screen</span>
<span class="c1">; sprite position in d0.b</span>
                <span class="k">move</span><span class="nd">.l </span> <span class="mh">$44e</span><span class="p">,</span> <span class="nb">a1</span>                  <span class="c1">; screen memory in a1</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nv">y_coord</span><span class="p">,</span> <span class="nb">d0</span>               <span class="c1">; put y coordinate in d0</span>
                <span class="k">mulu</span>    <span class="nd">#</span><span class="mi">160</span><span class="p">,</span> <span class="nb">d0</span>                  <span class="c1">; 160 bytes to a scan line</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nb">d0</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; add to screen pointer</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nv">x_coord</span><span class="p">,</span> <span class="nb">d0</span>               <span class="c1">; put x coordinate in d0</span>
                <span class="k">divu</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">16</span><span class="p">,</span> <span class="nb">d0</span>                   <span class="c1">; number of clusters in low, bit in high</span>
                <span class="k">clr</span><span class="nd">.l </span>  <span class="nb">d1</span>                        <span class="c1">; clear d1</span>
                <span class="k">move</span><span class="nd">.w </span> <span class="nb">d0</span><span class="p">,</span> <span class="nb">d1</span>                    <span class="c1">; move cluster part to d1</span>
                <span class="k">mulu</span><span class="nd">.w </span> <span class="nd">#</span><span class="mi">8</span><span class="p">,</span> <span class="nb">d1</span>                    <span class="c1">; 8 bytes to a cluster</span>
                <span class="k">add</span><span class="nd">.l </span>  <span class="nb">d1</span><span class="p">,</span> <span class="nb">a1</span>                    <span class="c1">; add cluster part to screen memory</span>
                <span class="k">clr</span><span class="nd">.w </span>  <span class="nb">d0</span>                        <span class="c1">; clear out the cluster value</span>
                <span class="k">swap</span>    <span class="nb">d0</span>                        <span class="c1">; bit to alter in low part of d0</span>

                <span class="k">rts</span>

                <span class="kr">include</span> <span class="nv">initlib</span><span class="nd">.s
</span>
                <span class="kr">section</span> <span class="nv">data</span>
<span class="nl">x_coord</span>         <span class="kt">dc</span><span class="nd">.w </span>   <span class="mi">0</span>
<span class="nl">y_coord</span>         <span class="kt">dc</span><span class="nd">.w </span>   <span class="mi">0</span>
<span class="nl">x_heading</span>       <span class="kt">dc</span><span class="nd">.w </span>   <span class="mi">1</span>
<span class="nl">y_heading</span>       <span class="kt">dc</span><span class="nd">.w </span>   <span class="mi">1</span>

<span class="nl">spr_dat</span>         <span class="kr">incbin</span>  <span class="nv">sprite</span><span class="p">.</span><span class="nv">pi1</span>
<span class="nl">bg</span>              <span class="kr">incbin</span>  <span class="nv">autumn</span><span class="p">.</span><span class="nv">pi1</span>
<span class="nl">old_70</span>          <span class="kt">dc</span><span class="nd">.l </span>   <span class="mi">0</span>

                <span class="kr">section</span> <span class="nv">bss</span>
<span class="nl">sprite</span>          <span class="kt">ds</span><span class="nd">.l </span>   <span class="mi">3072</span>                      <span class="c1">; 32/2+8*32 bytes 16 positions / 4 for long</span>
<span class="nl">mask</span>            <span class="kt">ds</span><span class="nd">.l </span>   <span class="mi">3072</span>                      <span class="c1">; same as above</span>
<span class="nl">bgsave</span>          <span class="kt">ds</span><span class="nd">.l </span>   <span class="mi">192</span>                       <span class="c1">; 32/2+8*32 bytes / 4 for long</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/tutorial-11-screenshot.png" alt="tutorial 11 screenshot">
</div>
<div class="title">Figure 19. Sprite on autumn</div>
</div>
<div class="paragraph">
<p>The longest source to date, I&#8217;m truly starting to doubt the wisdom of putting the source code
here as well as in a separate file. Anyways, starting from beginning going down, this is what
it&#8217;s all about. The first two lines are the X and Y speed, you may play around with these
values to your hearts content, of course, setting them both to the same value will make the
sprite move in 45 degrees, while any other values will make the sprite move differently.</p>
</div>
<div class="paragraph">
<p>Then, the pre-shifting of the sprite and the mask, this has been dealt with extensively and
there is nothing more to add. After this, the background is also prepared, it&#8217;s just another
put-degas-file-in-screen-memory. Note here, that there is a background save, this is to make
sure something is in the save buffer before starting the main routine, otherwise the main
routine would start off by "restoring" a blank area, effectively deleting a sprite sized block of
the screen.</p>
</div>
<div class="paragraph">
<p>All preparations are done, just install the main routine, as described in <a href="#">tutorial 9</a>.
Put our main routine in the <code>$70</code> vector, to have it executed every VBL. Wait for a key press, during
which the main routine will execute continuously, and make a clean exit. Now, take note of
how nice and tidy the main routine is, it just consists of subroutine calls, making the structure
of the program very easy to read, and isolating each major part of the program for ease of
reading.</p>
</div>
<div class="paragraph">
<p>Each subroutine in turn relies upon the <code>get_coordinates</code> routine, which translates the <code>x_coord</code>
and <code>y_coord</code> into data intelligible to the program. As you can see in the comments at the start
of the <code>get_coordinates</code> subroutine, what the routine does is to put a pointer to the screen
memory in <code>a0</code> and the sprite position (offset) in <code>d0.b</code> (meaning the least significant 8 bits of
the <code>d0</code> register). Since each subroutine relies upon the <code>get_coordinates</code> routine, if a bug is
detected in the coordinate routine, it will only have to be dealt with in one place.</p>
</div>
<div class="paragraph">
<p>The save/restore background routines are short and simple and do little. They begin by
calling the get_coordinates routine in order to get a screen pointer, the sprite position is
uninteresting since they both deal with the entire sprite block.</p>
</div>
<div class="paragraph">
<p>The sprite and mask routines are very similar. Both begin by calling the <code>get_coordinates</code>
routine, in order to get a screen pointer and a sprite position. Then either the sprite or mask
area is loaded as appropriate, and the sprite position applied as an offset. Then comes a loop
of moving data from the background and sprite or mask. Then this data is either ANDed or
ORed as appropriate. The result is put back in the screen memory.</p>
</div>
<div class="paragraph">
<p>Well, that is that. I haven&#8217;t gone into everything in minute detail, but by now you shouldn&#8217;t
have to be baby nursed through every operation. The source code has many fun things you
can do with it yourself, so test around some in the critical areas. The obvious change is the
speed change, then, you can try commenting out some things in the main routine, and
change an OR to a MOVE in the sprite routine for example. I think it&#8217;s a good idea to play
around some with the source code, and try to predict the changes, in this way, you&#8217;ll really
understand the underlying mechanics.</p>
</div>
<div class="paragraph">
<p>The next tutorial will probably be a very small one, I&#8217;m even considering of calling it tutorial
11 part B, and might cover the well known "infinite trail" of sprites, since it&#8217;s ridiculously easy.
Somewhere soon I suppose I&#8217;ll do one on joystick and perhaps also mouse operation. I won&#8217;t
promise anything though. Big thanks again go out to Bruno Padinha, for providing valuable
feedback and hitting me on the head. Damn, now I have to think of a good quote as well,
this part is the hardest. ☺</p>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_of_lighting_a_candle_and_casting_a_shadow.html">Of Lighting A Candle (And Casting A Shadow)</a> | ↑ Up: <a href="index.html">The Atari ST MC68000 Assembly Language Tutorials</a> | Next: <a href="_of_controlling_the_puppets.html">Of Controlling The Puppets</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1st edition (v0.84)<br>
Last updated 2022-04-18 16:48:36 UTC
</div>
</div>
</body>
</html>